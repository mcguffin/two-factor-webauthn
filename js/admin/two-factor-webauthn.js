!function(){var e={};(function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r="credentials"in navigator;e={register:function(e,t){var n=e.action,r=e.payload,i=e._wpnonce;!function(e,t){var n=Object.assign({},e.publicKey);n.attestation=void 0,n.challenge=new Uint8Array(n.challenge),n.user.id=new Uint8Array(n.user.id),navigator.credentials.create({publicKey:n}).then(function(n){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)));if(e.b64challenge!==a.challenge&&t(!1,"key returned something unexpected (1)"),!("type"in a))return t(!1,"key returned something unexpected (3)");if("webauthn.create"!=a.type)return t(!1,"key returned something unexpected (4)");var r=[];new Uint8Array(n.response.attestationObject).forEach(function(e){r.push(e)});var i=[];new Uint8Array(n.rawId).forEach(function(e){i.push(e)});var o={rawId:i,id:n.id,type:n.type,response:{attestationObject:r,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)))}};t(!0,JSON.stringify(o))}).catch(function(e){t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(r,function(e,r){e?a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:r,_wpnonce:i},success:t}):t({success:!1,message:r})})},login:function(e,t){e.action;var n=e.payload;e._wpnonce,function(e,t){var n=e.challenge,a=Object.assign({},e);a.challenge=new Uint8Array(e.challenge),a.allowCredentials=a.allowCredentials.map(function(e){var t=Object.assign({},e);return t.id=new Uint8Array(e.id),t}),navigator.credentials.get({publicKey:a}).then(function(e){var a=[];new Uint8Array(e.rawId).forEach(function(e){a.push(e)});var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON))),i=[];new Uint8Array(e.response.clientDataJSON).forEach(function(e){i.push(e)});var o=[];new Uint8Array(e.response.authenticatorData).forEach(function(e){o.push(e)});var s=[];new Uint8Array(e.response.signature).forEach(function(e){s.push(e)});var u={type:e.type,originalChallenge:n,rawId:a,response:{authenticatorData:o,clientData:r,clientDataJSONarray:i,signature:s}};t(!0,JSON.stringify(u))}).catch(function(e){console.log(e),t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(n,function(e,n){t(e?{success:!0,result:n}:{success:!1,message:n})})},sendRequest:function(e,t){var n=e.action,r=e.payload,i=e._wpnonce;a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:r,_wpnonce:i},success:t})},isWebauthnSupported:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r=function(t,n){var r=n.action,i=n.payload,o=n._wpnonce,s=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!1),(0,a.default)(document).off("keydown"),(0,a.default)(t).off("blur"),n&&u!==s?((0,a.default)('<span class="spinner"></span>').insertAfter(t),(0,e.sendRequest)({action:r,payload:{md5id:i,label:s},_wpnonce:o},function(e){(0,a.default)(t).next(".spinner").remove()})):n||(0,a.default)(t).text(u)},u=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!0),(0,a.default)(document).on("keydown",function(e){13===e.which?(s(!0),e.preventDefault()):27===e.which&&s(!0)}),(0,a.default)(t).on("blur",function(e){return s(!0)}),(0,a.default)(t).focus(),document.execCommand("selectAll",!1,null)};(0,a.default)(document).on("click","#webauthn-register-key",function(t){t.preventDefault(),(0,a.default)(t.target).next(".webauthn-error").remove();var n=JSON.parse((0,a.default)(t.target).attr("data-create-options"));(0,e.register)(n,function(e){if(e.success){var t=(0,a.default)(e.html).appendTo("#webauthn-keys").find(".webauthn-label");r(t.get(0),JSON.parse(t.attr("data-action")))}else(0,a.default)('<span class="webauthn-error description">'.concat(e.message,"</span>")).insertAfter("#webauthn-register-key")})}),e.isWebauthnSupported?(0,a.default)(document).on("click",".webauthn-action",function(t){t.preventDefault();var n=(0,a.default)(t.target).closest(".webauthn-action"),i=JSON.parse(n.attr("data-action")),o=(0,a.default)(t.target).closest(".webauthn-key"),s=i.action,u=(i.payload,i._wpnonce);"webauthn-test-key"===i.action?(t.preventDefault(),o.find(".notice").remove(),(0,e.login)(i,function(t){t.success?(0,e.sendRequest)({action:s,payload:t.result,_wpnonce:u},function(e){e.success?n.find("[data-tested]").attr("data-tested","tested"):(n.find("[data-tested]").attr("data-tested","fail"),o.append('<div class="notice notice-inline notice-error">'.concat(e.message,"</div>")))}):o.append('<div class="notice notice-inline notice-warning">'.concat(t.message,"</div>"))})):"webauthn-delete-key"===i.action&&(t.preventDefault(),(0,e.sendRequest)(i,function(e){e.success&&o.remove()})),"webauthn-edit-key"===i.action&&"true"!==(0,a.default)(t.currentTarget).prop("contenteditable")&&(t.preventDefault(),r(t.currentTarget,i))}):((0,a.default)(".webauthn-unsupported").removeClass("hidden"),(0,a.default)(".webauthn-supported").addClass("hidden"))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2stZmxhdC9fcHJlbHVkZSIsInNyYy9qcy9saWIvZGF2aWRlYXJsLXdlYmF1dGhuLmpzIiwic3JjL2pzL2FkbWluL3R3by1mYWN0b3Itd2ViYXV0aG4vaW5kZXguanMiXSwibmFtZXMiOlsiXyRkYXZpZGVhcmxXZWJhdXRobl8yIiwib2JqIiwiX2pxdWVyeSIsIndpbmRvdyIsImpRdWVyeSIsImdsb2JhbCIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiaXNXZWJhdXRoblN1cHBvcnRlZCIsIm5hdmlnYXRvciIsInJlZ2lzdGVyIiwib3B0cyIsImNhbGxiYWNrIiwiYWN0aW9uIiwicGF5bG9hZCIsIl93cG5vbmNlIiwia2V5IiwicHVibGljS2V5IiwiT2JqZWN0IiwiYXNzaWduIiwiYXR0ZXN0YXRpb24iLCJjaGFsbGVuZ2UiLCJVaW50OEFycmF5IiwidXNlciIsImlkIiwiY3JlZGVudGlhbHMiLCJjcmVhdGUiLCJ0aGVuIiwiYU5ld0NyZWRlbnRpYWxJbmZvIiwiY2QiLCJKU09OIiwicGFyc2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsInJlc3BvbnNlIiwiY2xpZW50RGF0YUpTT04iLCJiNjRjaGFsbGVuZ2UiLCJ0eXBlIiwiYW8iLCJhdHRlc3RhdGlvbk9iamVjdCIsImZvckVhY2giLCJ2IiwicHVzaCIsInJhd0lkIiwiaW5mbyIsInN0cmluZ2lmeSIsImNhdGNoIiwiZXJyIiwibmFtZSIsIm1lc3NhZ2UiLCJ0b1N0cmluZyIsInN1Y2Nlc3MiLCJhamF4IiwidXJsIiwid3AiLCJzZXR0aW5ncyIsIm1ldGhvZCIsImRhdGEiLCJsb2dpbiIsInB1YktleUF1dGgiLCJvcmlnaW5hbENoYWxsZW5nZSIsInBrIiwiYWxsb3dDcmVkZW50aWFscyIsIm1hcCIsImsiLCJyZXQiLCJnZXQiLCJhQXNzZXJ0aW9uIiwiaWRhIiwiY2RhIiwiYWQiLCJhdXRoZW50aWNhdG9yRGF0YSIsInNpZyIsInNpZ25hdHVyZSIsImNsaWVudERhdGEiLCJjbGllbnREYXRhSlNPTmFycmF5IiwiY29uc29sZSIsImxvZyIsInJlc3VsdCIsInNlbmRSZXF1ZXN0IiwiZWRpdEtleSIsImVkaXRMYWJlbCIsInN0b3BFZGl0aW5nIiwic2F2ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsIm5ld0xhYmVsIiwidGV4dCIsInByb3AiLCJkb2N1bWVudCIsIm9mZiIsInByZXZMYWJlbCIsImluc2VydEFmdGVyIiwibWQ1aWQiLCJsYWJlbCIsIm5leHQiLCJyZW1vdmUiLCJvbiIsImUiLCJ3aGljaCIsInByZXZlbnREZWZhdWx0IiwiZm9jdXMiLCJleGVjQ29tbWFuZCIsInRhcmdldCIsImF0dHIiLCIka2V5TGFiZWwiLCJodG1sIiwiYXBwZW5kVG8iLCJmaW5kIiwiY29uY2F0IiwiJGJ0biIsImNsb3Nlc3QiLCIka2V5RWwiLCJhcHBlbmQiLCJjdXJyZW50VGFyZ2V0IiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxJQUFBQSxFQUFBLDZCQ0RBLElBQUFDLEVBQUFDLEdBQUFELEVBQUEsb0JBQUFFLE9BQUFBLE9BQUFDLFlBQUEsSUFBQUMsRUFBQUEsRUFBQUQsT0FBQSxPQUFBSCxFQUFBSyxXQUFBTCxFQUFBLENBQUFNLFFBQUFOLEdBb01NTyxFQUFzQixnQkFBaUJDLFVBRTdDVCxFQUFpQixDQUNoQlUsU0F4RGdCLFNBQUVDLEVBQU1DLEdBQWMsSUFFOUJDLEVBQThCRixFQUE5QkUsT0FBUUMsRUFBc0JILEVBQXRCRyxRQUFTQyxFQUFhSixFQUFiSSxVQS9EMUIsU0FBMkJDLEVBQUtKLEdBRS9CLElBQUlLLEVBQVlDLE9BQU9DLE9BQVEsR0FBSUgsRUFBSUMsV0FFdkNBLEVBQVVHLGlCQUFBLEVBQ1ZILEVBQVVJLFVBQVksSUFBSUMsV0FBWUwsRUFBVUksV0FDaERKLEVBQVVNLEtBQUtDLEdBQUssSUFBSUYsV0FBWUwsRUFBVU0sS0FBS0MsSUFHbkRmLFVBQVVnQixZQUFZQyxPQUFRLENBQUVULFVB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LEdBRXZCQSxFQUFTaUIsU0FFYjZELEVBQU9oQixZQUdhLHNCQUFoQnRGLEVBQUtFLFFBQ04sVUFBQSxFQUFXWCxFQUFBSyxTQUFFNEYsRUFBRWdCLGVBQWUxQixLQUFNLHFCQUN4Q1UsRUFBRUUsaUJBQ0ZwQixFQUFTa0IsRUFBRWdCLGNBQWV4RyxRQUFBLEVBSzdCVCxFQUFBSyxTQUFFLHlCQUF5QjZHLFlBQVksV0FBQSxFQUN2Q2xILEVBQUFLLFNBQUUsdUJBQXVCOEcsU0FBUyw0SEZqSW5DIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XG4iLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknXG5cblxuXG5cbi8qKlxuICpcdFN0b2xlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXZpZGVhcmwvd2ViYXV0aG5cbiAqL1xuZnVuY3Rpb24gd2ViYXV0aG5BdXRoZW50aWNhdGUoIHB1YktleUF1dGgsIGNhbGxiYWNrICkge1xuXG5cdGNvbnN0IG9yaWdpbmFsQ2hhbGxlbmdlID0gcHViS2V5QXV0aC5jaGFsbGVuZ2U7XG5cdGNvbnN0IHBrID0gT2JqZWN0LmFzc2lnbigge30sIHB1YktleUF1dGggKVxuXG5cdHBrLmNoYWxsZW5nZSA9IG5ldyBVaW50OEFycmF5KCBwdWJLZXlBdXRoLmNoYWxsZW5nZSApXG5cdHBrLmFsbG93Q3JlZGVudGlhbHMgPSBway5hbGxvd0NyZWRlbnRpYWxzLm1hcCggayA9PiB7XG5cdFx0bGV0IHJldCA9IE9iamVjdC5hc3NpZ24oIHt9LCBrIClcblx0XHRyZXQuaWQgPSBuZXcgVWludDhBcnJheShrLmlkKTtcblx0XHRyZXR1cm4gcmV0XG5cdH0gKVxuXG5cdC8qIGFzayB0aGUgYnJvd3NlciB0byBwcm9tcHQgdGhlIHVzZXIgKi9cblx0bmF2aWdhdG9yLmNyZWRlbnRpYWxzLmdldCggeyBwdWJsaWNLZXk6IHBrIH0gKVxuXHRcdC50aGVuKCBhQXNzZXJ0aW9uID0+IHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKFwiQ3JlZGVudGlhbHMuR2V0IHJlc3BvbnNlOiBcIiwgYUFzc2VydGlvbik7XG5cdFx0XHR2YXIgaWRhID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7IGlkYS5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBjZCA9IEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCAgbmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpKTtcblx0XHRcdHZhciBjZGEgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhQXNzZXJ0aW9uLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgY2RhLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGFkID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5hdXRoZW50aWNhdG9yRGF0YSkpLmZvckVhY2goZnVuY3Rpb24odil7IGFkLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIHNpZyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2Uuc2lnbmF0dXJlKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgc2lnLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGluZm8gPSB7XG5cdFx0XHRcdHR5cGU6IGFBc3NlcnRpb24udHlwZSxcblx0XHRcdFx0b3JpZ2luYWxDaGFsbGVuZ2U6IG9yaWdpbmFsQ2hhbGxlbmdlLFxuXHRcdFx0XHRyYXdJZDogaWRhLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF1dGhlbnRpY2F0b3JEYXRhOiBhZCxcblx0XHRcdFx0XHRjbGllbnREYXRhOiBjZCxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTmFycmF5OiBjZGEsXG5cdFx0XHRcdFx0c2lnbmF0dXJlOiBzaWdcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNhbGxiYWNrKCB0cnVlLCBKU09OLnN0cmluZ2lmeSggaW5mbyApICk7XG5cdFx0fSlcblx0XHQuY2F0Y2goIGVyciA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpXG5cdFx0XHQvKlxuXHRcdFx0RkYgbWFjOlxuXHRcdFx0SW52YWxpZFN0YXRlRXJyb3I6IGtleSBub3QgZm91bmRcblx0XHRcdEFib3J0RXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogP1xuXHRcdFx0XHRUaGUgcmVxdWVzdCBpcyBub3QgYWxsb3dlZCBieSB0aGUgdXNlciBhZ2VudCBvciB0aGUgcGxhdGZvcm0gaW4gdGhlIGN1cnJlbnQgY29udGV4dCwgcG9zc2libHkgYmVjYXVzZSB0aGUgdXNlciBkZW5pZWQgcGVybWlzc2lvbi5cblxuXHRcdFx0Q2hyb21lIG1hYzpcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRTYWZhcmkgbWFjOlxuXHRcdFx0Tm90QWxsb3dlZEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cblx0XHRcdEVkZ2Ugd2luMTA6XG5cdFx0XHRVbmtub3duRXJyb3I6IHdyb25nIGtleS4uLj9cblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRGRiB3aW46XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblx0XHRcdFx0RE9NRXhjZXB0aW9uOiBcIlRoZSByZXF1ZXN0IGlzIG5vdCBhbGxvd2VkIGJ5IHRoZSB1c2VyIGFnZW50IG9yIHRoZSBwbGF0Zm9ybSBpbiB0aGUgY3VycmVudCBjb250ZXh0LCBwb3NzaWJseSBiZWNhdXNlIHRoZSB1c2VyIGRlbmllZCBwZXJtaXNzaW9uLlwiXG5cblx0XHRcdCovXG5cdFx0XHRpZiAoIFwibmFtZVwiIGluIGVyciApIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIubmFtZSArICc6ICcgKyBlcnIubWVzc2FnZSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIudG9TdHJpbmcoKSApO1xuXHRcdFx0fVxuXHRcdH0pO1xufVxuXG4vKipcbiAqXHRTdG9sZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRlYXJsL3dlYmF1dGhuXG4gKi9cbmZ1bmN0aW9uIHdlYmF1dGhuUmVnaXN0ZXIoIGtleSwgY2FsbGJhY2sgKXtcblxuXHRsZXQgcHVibGljS2V5ID0gT2JqZWN0LmFzc2lnbigge30sIGtleS5wdWJsaWNLZXkgKTtcblxuXHRwdWJsaWNLZXkuYXR0ZXN0YXRpb24gPSB1bmRlZmluZWQ7XG5cdHB1YmxpY0tleS5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LmNoYWxsZW5nZSApOyAvLyBjb252ZXJ0IHR5cGUgZm9yIHVzZSBieSBrZXlcblx0cHVibGljS2V5LnVzZXIuaWQgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LnVzZXIuaWQgKTtcblxuXHQvLyBjb25zb2xlLmxvZyhrZXkpO1xuXHRuYXZpZ2F0b3IuY3JlZGVudGlhbHMuY3JlYXRlKCB7IHB1YmxpY0tleSB9IClcblx0XHQudGhlbihmdW5jdGlvbiAoYU5ld0NyZWRlbnRpYWxJbmZvKSB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkNyZWRlbnRpYWxzLkNyZWF0ZSByZXNwb25zZTogXCIsIGFOZXdDcmVkZW50aWFsSW5mbyk7XG5cdFx0XHR2YXIgY2QgPSBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYU5ld0NyZWRlbnRpYWxJbmZvLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkpO1xuXHRcdFx0aWYgKCBrZXkuYjY0Y2hhbGxlbmdlICE9PSBjZC5jaGFsbGVuZ2UgKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgxKScpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gaWYgKCdodHRwczovLycra2V5LnB1YmxpY0tleS5ycC5uYW1lICE9IGNkLm9yaWdpbikge1xuXHRcdFx0Ly8gXHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDIpJyk7XG5cdFx0XHQvLyB9XG5cdFx0XHRpZiAoISAoJ3R5cGUnIGluIGNkKSkge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDMpJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoY2QudHlwZSAhPSAnd2ViYXV0aG4uY3JlYXRlJykge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDQpJyk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBhbyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yZXNwb25zZS5hdHRlc3RhdGlvbk9iamVjdCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdGFvLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciByYXdJZCA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdHJhd0lkLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciBpbmZvID0ge1xuXHRcdFx0XHRyYXdJZDogcmF3SWQsXG5cdFx0XHRcdGlkOiBhTmV3Q3JlZGVudGlhbEluZm8uaWQsXG5cdFx0XHRcdHR5cGU6IGFOZXdDcmVkZW50aWFsSW5mby50eXBlLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF0dGVzdGF0aW9uT2JqZWN0OiBhbyxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTjpcblx0XHRcdFx0XHQgIEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmVzcG9uc2UuY2xpZW50RGF0YUpTT04pKSlcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNhbGxiYWNrKHRydWUsIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcblx0XHR9KVxuXHRcdC5jYXRjaCggZXJyID0+IHtcblx0XHRcdGlmICggXCJuYW1lXCIgaW4gZXJyICkge1xuXHRcdFx0XHRjYWxsYmFjayggZmFsc2UsIGVyci5uYW1lICsgJzogJyArIGVyci5tZXNzYWdlICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjYWxsYmFjayggZmFsc2UsIGVyci50b1N0cmluZygpICk7XG5cdFx0XHR9XG5cdFx0fSk7XG59XG5cbi8qKlxuICpcdEBwYXJhbSBBcnJheUJ1ZmZlciBhcnJheUJ1ZlxuICpcdEByZXR1cm4gQXJyYXlcbiAqL1xuY29uc3QgYnVmZmVyMkFycmF5ID0gYXJyYXlCdWYgPT4gWyAuLi4gKG5ldyBVaW50OEFycmF5KCBhcnJheUJ1ZiApKSBdO1xuXG5jb25zdCByZWdpc3RlciA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuUmVnaXN0ZXIoIHBheWxvYWQsIChzdWNjZXNzLGluZm8pID0+IHtcblx0XHRpZiAoIHN1Y2Nlc3MgKSB7XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6IHdwLmFqYXguc2V0dGluZ3MudXJsLFxuXHRcdFx0XHRtZXRob2Q6ICdwb3N0Jyxcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogYWN0aW9uLFxuXHRcdFx0XHRcdHBheWxvYWQ6IGluZm8sXG5cdFx0XHRcdFx0X3dwbm9uY2U6IF93cG5vbmNlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN1Y2Nlc3M6IGNhbGxiYWNrXG5cdFx0XHR9KVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYWxsYmFjayggeyBzdWNjZXNzOmZhbHNlLCBtZXNzYWdlOmluZm8gfSApXG5cdFx0fVxuXHR9KVxufVxuXG5cbmNvbnN0IGxvZ2luID0gKCBvcHRzLCBjYWxsYmFjayApID0+IHtcblxuXHRjb25zdCB7IGFjdGlvbiwgcGF5bG9hZCwgX3dwbm9uY2UgfSA9IG9wdHM7XG5cblx0d2ViYXV0aG5BdXRoZW50aWNhdGUoIHBheWxvYWQsICggc3VjY2VzcywgaW5mbyApID0+IHtcblx0XHRpZiAoIHN1Y2Nlc3MgKSB7XG5cdFx0XHRjYWxsYmFjayggeyBzdWNjZXNzOnRydWUsIHJlc3VsdDogaW5mbyB9IClcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2FsbGJhY2soIHsgc3VjY2VzczpmYWxzZSwgbWVzc2FnZTogaW5mbyB9IClcblx0XHR9XG5cblx0fSlcbn1cblxuY29uc3Qgc2VuZFJlcXVlc3QgPSAoIG9wdHMsIGNhbGxiYWNrICkgPT4ge1xuXG5cdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0cztcblxuXHQkLmFqYXgoe1xuXHRcdHVybDogd3AuYWpheC5zZXR0aW5ncy51cmwsXG5cdFx0bWV0aG9kOiAncG9zdCcsXG5cdFx0ZGF0YToge1xuXHRcdFx0YWN0aW9uOiBhY3Rpb24sXG5cdFx0XHRwYXlsb2FkOiBwYXlsb2FkLFxuXHRcdFx0X3dwbm9uY2U6IF93cG5vbmNlXG5cdFx0fSxcblx0XHRzdWNjZXNzOmNhbGxiYWNrXG5cdH0pXG59XG5cbmNvbnN0IGlzV2ViYXV0aG5TdXBwb3J0ZWQgPSAnY3JlZGVudGlhbHMnIGluIG5hdmlnYXRvclxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0cmVnaXN0ZXIsXG5cdGxvZ2luLFxuXHRzZW5kUmVxdWVzdCxcblx0aXNXZWJhdXRoblN1cHBvcnRlZFxufVxuIiwiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuaW1wb3J0IHsgcmVnaXN0ZXIsIGxvZ2luLCBzZW5kUmVxdWVzdCwgaXNXZWJhdXRoblN1cHBvcnRlZCB9IGZyb20gJ2RhdmlkZWFybC13ZWJhdXRobidcblxuXG5cbmNvbnN0IGVkaXRLZXkgPSAoIGVkaXRMYWJlbCwgb3B0cyApID0+IHtcblxuXHRjb25zdCB7IGFjdGlvbiwgcGF5bG9hZCwgX3dwbm9uY2UgfSA9IG9wdHNcblxuXG5cdC8vIGNvbnNvbGUubG9nKCRlZGl0TGFiZWwucHJvcCggJ2NvbnRlbnRlZGl0YWJsZScgKSk7XG5cdGNvbnN0IHN0b3BFZGl0aW5nID0gKCBzYXZlID0gZmFsc2UgKSA9PiB7XG5cdFx0bGV0IG5ld0xhYmVsID0gJChlZGl0TGFiZWwpLnRleHQoKVxuXHRcdCQoZWRpdExhYmVsKS5wcm9wKCAnY29udGVudGVkaXRhYmxlJywgZmFsc2UgKTtcblx0XHQkKGRvY3VtZW50KS5vZmYoICdrZXlkb3duJyApXG5cdFx0JChlZGl0TGFiZWwpLm9mZiggJ2JsdXInIClcblx0XHRpZiAoIHNhdmUgJiYgcHJldkxhYmVsICE9PSBuZXdMYWJlbCApIHtcblxuXHRcdFx0JCgnPHNwYW4gY2xhc3M9XCJzcGlubmVyXCI+PC9zcGFuPicpLmluc2VydEFmdGVyKGVkaXRMYWJlbClcblxuXHRcdFx0c2VuZFJlcXVlc3QoXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRhY3Rpb24sXG5cdFx0XHRcdFx0cGF5bG9hZDogeyBtZDVpZDogcGF5bG9hZCwgbGFiZWw6IG5ld0xhYmVsIH0sXG5cdFx0XHRcdFx0X3dwbm9uY2Vcblx0XHRcdFx0fSxcblx0XHRcdFx0cmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdCQoZWRpdExhYmVsKS5uZXh0KCcuc3Bpbm5lcicpLnJlbW92ZSgpXG5cdFx0XHRcdH1cblx0XHRcdCk7XG5cdFx0fSBlbHNlIGlmICggISBzYXZlICkge1xuXHRcdFx0JChlZGl0TGFiZWwpLnRleHQocHJldkxhYmVsKVxuXHRcdH1cblx0fVxuXG5cdGNvbnN0IHByZXZMYWJlbCA9ICQoZWRpdExhYmVsKS50ZXh0KClcblxuXHQkKGVkaXRMYWJlbCkucHJvcCggJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUgKTtcblxuXHQkKGRvY3VtZW50KS5vbiggJ2tleWRvd24nLCBlID0+IHtcblx0XHRpZiAoIGUud2hpY2ggPT09IDEzICkge1xuXHRcdFx0c3RvcEVkaXRpbmcoIHRydWUgKVxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0fSBlbHNlIGlmICggZS53aGljaCA9PT0gMjcgKSB7XG5cdFx0XHRzdG9wRWRpdGluZyggdHJ1ZSApXG5cdFx0fVxuXHR9IClcblxuXHQvLyBmb2N1cyBhbmQgc2VsZWN0XG5cdCQoZWRpdExhYmVsKS5vbiggJ2JsdXInLCBlID0+IHN0b3BFZGl0aW5nKCB0cnVlICkgKVxuXG5cdCQoZWRpdExhYmVsKS5mb2N1cygpXG5cblx0ZG9jdW1lbnQuZXhlY0NvbW1hbmQoICdzZWxlY3RBbGwnLCBmYWxzZSwgbnVsbCApO1xuXG59XG5cbiQoZG9jdW1lbnQpLm9uKCAnY2xpY2snLCAnI3dlYmF1dGhuLXJlZ2lzdGVyLWtleScsIGUgPT4ge1xuXG5cdGUucHJldmVudERlZmF1bHQoKTtcblxuXHQkKGUudGFyZ2V0KS5uZXh0KCcud2ViYXV0aG4tZXJyb3InKS5yZW1vdmUoKVxuXG5cdGNvbnN0IG9wdHMgPSBKU09OLnBhcnNlKCAkKGUudGFyZ2V0KS5hdHRyKCdkYXRhLWNyZWF0ZS1vcHRpb25zJykgKTtcblxuXHRyZWdpc3Rlciggb3B0cywgcmVzcG9uc2UgPT4ge1xuXG5cdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0bGV0ICRrZXlJdGVtID0gJChyZXNwb25zZS5odG1sKS5hcHBlbmRUbygnI3dlYmF1dGhuLWtleXMnKVxuXHRcdFx0bGV0ICRrZXlMYWJlbCA9ICRrZXlJdGVtLmZpbmQoJy53ZWJhdXRobi1sYWJlbCcpXG5cblx0XHRcdGVkaXRLZXkoXG5cdFx0XHRcdCRrZXlMYWJlbC5nZXQoMCksXG5cdFx0XHRcdEpTT04ucGFyc2UoICRrZXlMYWJlbC5hdHRyKCdkYXRhLWFjdGlvbicpIClcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoYDxzcGFuIGNsYXNzPVwid2ViYXV0aG4tZXJyb3IgZGVzY3JpcHRpb25cIj4ke3Jlc3BvbnNlLm1lc3NhZ2V9PC9zcGFuPmApLmluc2VydEFmdGVyKCcjd2ViYXV0aG4tcmVnaXN0ZXIta2V5Jylcblx0XHR9XG5cdH0pO1xuXG59KTtcblxuaWYgKCBpc1dlYmF1dGhuU3VwcG9ydGVkICkge1xuXHQkKGRvY3VtZW50KS5vbignY2xpY2snLCcud2ViYXV0aG4tYWN0aW9uJywgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGNvbnN0ICRidG4gPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcud2ViYXV0aG4tYWN0aW9uJyk7XG5cdFx0Y29uc3Qgb3B0cyA9IEpTT04ucGFyc2UoICRidG4uYXR0cignZGF0YS1hY3Rpb24nKSApO1xuXHRcdGNvbnN0ICRrZXlFbCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy53ZWJhdXRobi1rZXknKVxuXHRcdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0c1xuXG5cblxuXHRcdGlmICggb3B0cy5hY3Rpb24gPT09ICd3ZWJhdXRobi10ZXN0LWtleScgKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHQka2V5RWwuZmluZCgnLm5vdGljZScpLnJlbW92ZSgpO1xuXHRcdFx0bG9naW4oIG9wdHMsIHJlc3VsdCA9PiB7XG5cdFx0XHRcdC8vIHNlbmQgdGhhdCBjcmFwIHRvIHNlcnZlclxuXG5cdFx0XHRcdGlmICggISByZXN1bHQuc3VjY2VzcyApIHtcblx0XHRcdFx0XHQka2V5RWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwibm90aWNlIG5vdGljZS1pbmxpbmUgbm90aWNlLXdhcm5pbmdcIj4ke3Jlc3VsdC5tZXNzYWdlfTwvZGl2PmApXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbmRSZXF1ZXN0KCB7IGFjdGlvbiwgcGF5bG9hZDogcmVzdWx0LnJlc3VsdCwgX3dwbm9uY2UgfSwgcmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdGlmICggcmVzcG9uc2Uuc3VjY2VzcyApIHtcblx0XHRcdFx0XHRcdCRidG4uZmluZCgnW2RhdGEtdGVzdGVkXScpLmF0dHIoJ2RhdGEtdGVzdGVkJywndGVzdGVkJylcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JGJ0bi5maW5kKCdbZGF0YS10ZXN0ZWRdJykuYXR0cignZGF0YS10ZXN0ZWQnLCdmYWlsJylcblx0XHRcdFx0XHRcdCRrZXlFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJub3RpY2Ugbm90aWNlLWlubGluZSBub3RpY2UtZXJyb3JcIj4ke3Jlc3BvbnNlLm1lc3NhZ2V9PC9kaXY+YClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pXG5cdFx0XHR9ICk7XG5cdFx0fSBlbHNlIGlmICggb3B0cy5hY3Rpb24gPT09ICd3ZWJhdXRobi1kZWxldGUta2V5JyApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHNlbmRSZXF1ZXN0KCBvcHRzLCBmdW5jdGlvbiggcmVzcG9uc2UgKSB7XG5cdFx0XHRcdC8vIHJlbW92ZVxuXHRcdFx0XHRpZiAoIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG5cblx0XHRcdFx0XHQka2V5RWwucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gKTtcblx0XHR9IGlmICggb3B0cy5hY3Rpb24gPT09ICd3ZWJhdXRobi1lZGl0LWtleScgKSB7XG5cdFx0XHRpZiAoICd0cnVlJyAhPT0gJChlLmN1cnJlbnRUYXJnZXQpLnByb3AoICdjb250ZW50ZWRpdGFibGUnICkgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0ZWRpdEtleSggZS5jdXJyZW50VGFyZ2V0LCBvcHRzICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn0gZWxzZSB7XG5cdCQoJy53ZWJhdXRobi11bnN1cHBvcnRlZCcpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcblx0JCgnLndlYmF1dGhuLXN1cHBvcnRlZCcpLmFkZENsYXNzKCdoaWRkZW4nKTtcbn1cbiJdfQ==