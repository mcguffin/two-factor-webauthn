!function(){var e,n={};(function(e){"use strict";var t,a=(t="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&t.__esModule?t:{default:t};n={register:function(e,n){e.action;var t=e.payload;e._wpnonce,function(e,n){(e=JSON.parse(e)).publicKey.attestation=void 0,e.publicKey.challenge=new Uint8Array(e.publicKey.challenge),e.publicKey.user.id=new Uint8Array(e.publicKey.user.id),navigator.credentials.create({publicKey:e.publicKey}).then(function(t){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.response.clientDataJSON)));if(e.b64challenge!=a.challenge&&n(!1,"key returned something unexpected (1)"),"https://"+e.publicKey.rp.name!=a.origin)return n(!1,"key returned something unexpected (2)");if(!("type"in a))return n(!1,"key returned something unexpected (3)");if("webauthn.create"!=a.type)return n(!1,"key returned something unexpected (4)");var r=[];new Uint8Array(t.response.attestationObject).forEach(function(e){r.push(e)});var i=[];new Uint8Array(t.rawId).forEach(function(e){i.push(e)});var o={rawId:i,id:t.id,type:t.type,response:{attestationObject:r,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.response.clientDataJSON)))}};n(!0,JSON.stringify(o))}).catch(function(e){"name"in e&&("AbortError"==e.name||"NS_ERROR_ABORT"==e.name)||"NotAllowedError"==e.name?n(!1,"abort"):n(!1,e.toString())})}(t,function(t,r){a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:"webauthn-register",payload:r,_wpnonce:e._wpnonce},success:n})})},login:function(e,n){e.action;var t,a,r,i,o=e.payload;e._wpnonce,t=o,a=function(e,t){n({success:e,result:t})},r=JSON.parse(t),i=r.challenge,r.challenge=new Uint8Array(r.challenge),r.allowCredentials.forEach(function(e,n){r.allowCredentials[n].id=new Uint8Array(e.id)}),navigator.credentials.get({publicKey:r}).then(function(e){var n=[];new Uint8Array(e.rawId).forEach(function(e){n.push(e)});var t=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON))),r=[];new Uint8Array(e.response.clientDataJSON).forEach(function(e){r.push(e)});var o=[];new Uint8Array(e.response.authenticatorData).forEach(function(e){o.push(e)});var c=[];new Uint8Array(e.response.signature).forEach(function(e){c.push(e)});var u={type:e.type,originalChallenge:i,rawId:n,response:{authenticatorData:o,clientData:t,clientDataJSONarray:r,signature:c}};a(!0,JSON.stringify(u))}).catch(function(e){"name"in e&&("AbortError"==e.name||"NS_ERROR_ABORT"==e.name||"NotAllowedError"==e.name)?a(!1,"abort"):a(!1,e.toString())})},deleteKey:function(e,n){var t=e.action,r=(e.payload,e._wpnonce);a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:t,payload:info,_wpnonce:r},success:n})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),(e=jQuery)(document).on("click","#webauthn-register-key",function(t){t.preventDefault();var a=JSON.parse(e(t.target).attr("data-create-options"));(0,n.register)(a,function(n){e("#webauthn-keys").append(n.html)})}),e(document).on("click",".webauthn-action-button",function(t){t.preventDefault();var a=JSON.parse(e(t.target).attr("data-action")),r=t.target;"webauthn-test-key"===a.action?(0,n.login)(a,function(n){console.log(n),e(r).append('<span class="dashicons dashicons-yes-alt"></span>')}):"webauthn-delete-key"===a.action&&(0,n.deleteKey)(a,function(n){n.success&&e(r).closest(".webauthn-key").remove()})})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2stZmxhdC9fcHJlbHVkZSIsInNyYy9qcy9hZG1pbi90d28tZmFjdG9yLXdlYmF1dGhuL2luZGV4LmpzIiwic3JjL2pzL2xpYi9kYXZpZGVhcmwtd2ViYXV0aG4uanMiXSwibmFtZXMiOlsiJCIsIl8kZGF2aWRlYXJsV2ViYXV0aG5fMiIsIm9iaiIsIl9qcXVlcnkiLCJ3aW5kb3ciLCJqUXVlcnkiLCJnbG9iYWwiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInJlZ2lzdGVyIiwib3B0cyIsImNhbGxiYWNrIiwiYWN0aW9uIiwicGF5bG9hZCIsIl93cG5vbmNlIiwia2V5IiwiSlNPTiIsInBhcnNlIiwicHVibGljS2V5IiwiYXR0ZXN0YXRpb24iLCJjaGFsbGVuZ2UiLCJVaW50OEFycmF5IiwidXNlciIsImlkIiwibmF2aWdhdG9yIiwiY3JlZGVudGlhbHMiLCJjcmVhdGUiLCJ0aGVuIiwiYU5ld0NyZWRlbnRpYWxJbmZvIiwiY2QiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsInJlc3BvbnNlIiwiY2xpZW50RGF0YUpTT04iLCJiNjRjaGFsbGVuZ2UiLCJycCIsIm5hbWUiLCJvcmlnaW4iLCJ0eXBlIiwiYW8iLCJhdHRlc3RhdGlvbk9iamVjdCIsImZvckVhY2giLCJ2IiwicHVzaCIsInJhd0lkIiwiaW5mbyIsInN0cmluZ2lmeSIsImNhdGNoIiwiYUVyciIsInRvU3RyaW5nIiwic3VjY2VzcyIsImFqYXgiLCJ1cmwiLCJ3cCIsInNldHRpbmdzIiwibWV0aG9kIiwiZGF0YSIsImxvZ2luIiwiY2IiLCJwayIsIm9yaWdpbmFsQ2hhbGxlbmdlIiwicmVzdWx0IiwiYWxsb3dDcmVkZW50aWFscyIsImsiLCJpZHgiLCJnZXQiLCJhQXNzZXJ0aW9uIiwiaWRhIiwiY2RhIiwiYWQiLCJhdXRoZW50aWNhdG9yRGF0YSIsInNpZyIsInNpZ25hdHVyZSIsImNsaWVudERhdGEiLCJjbGllbnREYXRhSlNPTmFycmF5IiwiZGVsZXRlS2V5IiwiZG9jdW1lbnQiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInRhcmdldCIsImF0dHIiLCJhcHBlbmQiLCJodG1sIiwiYnRuIiwiY29uc29sZSIsImxvZyIsImNsb3Nlc3QiLCJyZW1vdmUiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsSUNDVUEsRUREVkMsRUFBQSw2QkVEQSxJQUFBQyxFQUFBQyxHQUFBRCxFQUFBLG9CQUFBRSxPQUFBQSxPQUFBQyxZQUFBLElBQUFDLEVBQUFBLEVBQUFELE9BQUEsT0FBQUgsRUFBQUssV0FBQUwsRUFBQSxDQUFBTSxRQUFBTixHQTBKQUQsRUFBaUIsQ0FDaEJRLFNBOUNnQixTQUFFQyxFQUFNQyxHQUVjRCxFQUE5QkUsT0FGOEIsSUFFdEJDLEVBQXNCSCxFQUF0QkcsUUFBc0JILEVBQWJJLFNBaEUxQixTQUEwQkMsRUFBS0osSUFDOUJJLEVBQU1DLEtBQUtDLE1BQU1GLElBQ2JHLFVBQVVDLGlCQUFBLEVBQ2RKLEVBQUlHLFVBQVVFLFVBQVksSUFBSUMsV0FBV04sRUFBSUcsVUFBVUUsV0FDdkRMLEVBQUlHLFVBQVVJLEtBQUtDLEdBQUssSUFBSUYsV0FBV04sRUFBSUcsVUFBVUksS0FBS0MsSUFHMURDLFVBQVVDLFlBQVlDLE9BQU8sQ0FBQ1IsVUFBV0gsRUFBSUcsWUFDM0NTLEtBQUssU0FBVUMsR0FFZixJQUFJQyxFQUFLYixLQUFLQyxNQUFNYSxPQUFPQyxhQUFhQyxNQUFNLEtBQU0sSUFBSVgsV0FBV08sRUFBbUJLLFNBQVNDLGtCQUkvRixHQUhJbkIsRUFBSW9CLGNBQWdCTixFQUFHVCxXQUMxQlQsR0FBQSxFQUFnQix5Q0FFYixXQUFXSSxFQUFJRyxVQUFVa0IsR0FBR0MsTUFBUVIsRUFBR1MsT0FDMUMsT0FBTzNCLEdBQUEsRUFBZ0IseUNBRXhCLEtBQU8sU0FBVWtCLEdBQ2hCLE9BQU9sQixHQUFBLEVBQWdCLHlDQUV4QixHQUFlLG1CQUFYa0IsRUFBR1UsS0FDTixPQUFPNUIsR0FBQSxFQUFnQix5Q0FHeEIsSUFBSTZCLEVB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S0MsZUFpSEQwQixVQWxCQSxTQUFFbEUsRUFBTUMsR0FBYyxJQUUvQkMsRUFBOEJGLEVBQTlCRSxPQUFpQkUsR0FBYUosRUFBdEJHLFFBQXNCSCxFQUFiSSxVQUV6QlgsRUFBQUssUUFBRTRDLEtBQUssQ0FDTkMsSUFBS0MsR0FBR0YsS0FBS0csU0FBU0YsSUFDdEJHLE9BQVEsT0FDUkMsS0FBTSxDQUNMN0MsT0FBUUEsRUFDUkMsUUFBU2lDLEtBQ1RoQyxTQUFVQSxHQUVYcUMsUUFBUXhDLHlIRG5KQVgsRUFtQ1BLLFFBakNBd0UsVUFBVUMsR0FBSSxRQUFTLHlCQUEwQixTQUFBQyxHQUVsREEsRUFBRUMsaUJBRUYsSUFBTXRFLEVBQU9NLEtBQUtDLE1BQU9qQixFQUFFK0UsRUFBRUUsUUFBUUMsS0FBSyx5QkFBQSxFQUUxQ2pGLEVBQUFRLFVBQVVDLEVBQU0sU0FBQXVCLEdBQ2ZqQyxFQUFFLGtCQUFrQm1GLE9BQU9sRCxFQUFTbUQsVUFLdENwRixFQUFFNkUsVUFBVUMsR0FBRyxRQUFRLDBCQUEyQixTQUFBQyxHQUNqREEsRUFBRUMsaUJBQ0YsSUFBTXRFLEVBQU9NLEtBQUtDLE1BQU9qQixFQUFFK0UsRUFBRUUsUUFBUUMsS0FBSyxnQkFDcENHLEVBQU1OLEVBQUVFLE9BQ08sc0JBQWhCdkUsRUFBS0UsUUFBQSxFQUNUWCxFQUFBeUQsT0FBT2hELEVBQU0sU0FBVXVCLEdBRXRCcUQsUUFBUUMsSUFBSXRELEdBQ1pqQyxFQUFFcUYsR0FBS0YsT0FBTyx1REFFWSx3QkFBaEJ6RSxFQUFLRSxTQUFBLEVBQ2hCWCxFQUFBMkUsV0FBV2xFLEVBQU0sU0FBVXVCLEdBRXJCQSxFQUFTa0IsU0FFYm5ELEVBQUVxRixHQUFLRyxRQUFRLGlCQUFpQkMsYUQvQnJDIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XG4iLCJpbXBvcnQgeyByZWdpc3RlciwgbG9naW4sIGRlbGV0ZUtleSB9IGZyb20gJ2RhdmlkZWFybC13ZWJhdXRobidcblxuKGZ1bmN0aW9uKCQpe1xuXG5cdCQoZG9jdW1lbnQpLm9uKCAnY2xpY2snLCAnI3dlYmF1dGhuLXJlZ2lzdGVyLWtleScsIGUgPT4ge1xuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0Y29uc3Qgb3B0cyA9IEpTT04ucGFyc2UoICQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtY3JlYXRlLW9wdGlvbnMnKSApO1xuXG5cdFx0cmVnaXN0ZXIoIG9wdHMsIHJlc3BvbnNlID0+IHtcblx0XHRcdCQoJyN3ZWJhdXRobi1rZXlzJykuYXBwZW5kKHJlc3BvbnNlLmh0bWwpXG5cdFx0fSk7XG5cblx0fSk7XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrJywnLndlYmF1dGhuLWFjdGlvbi1idXR0b24nLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0Y29uc3Qgb3B0cyA9IEpTT04ucGFyc2UoICQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtYWN0aW9uJykgKTtcblx0XHRjb25zdCBidG4gPSBlLnRhcmdldDtcblx0XHRpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tdGVzdC1rZXknICkge1xuXHRcdFx0bG9naW4oIG9wdHMsIGZ1bmN0aW9uKCByZXNwb25zZSApIHtcblx0XHRcdFx0Ly8gc2VuZCB0aGF0IGNyYXAgdG8gc2VydmVyXG5cdFx0XHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlKVxuXHRcdFx0XHQkKGJ0bikuYXBwZW5kKCc8c3BhbiBjbGFzcz1cImRhc2hpY29ucyBkYXNoaWNvbnMteWVzLWFsdFwiPjwvc3Bhbj4nKVxuXHRcdFx0fSApO1xuXHRcdH0gZWxzZSBpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tZGVsZXRlLWtleScgKSB7XG5cdFx0XHRkZWxldGVLZXkoIG9wdHMsIGZ1bmN0aW9uKCByZXNwb25zZSApIHtcblx0XHRcdFx0Ly8gcmVtb3ZlXG5cdFx0XHRcdGlmICggcmVzcG9uc2Uuc3VjY2VzcyApIHtcblxuXHRcdFx0XHRcdCQoYnRuKS5jbG9zZXN0KCcud2ViYXV0aG4ta2V5JykucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0gKTtcblx0XHR9XG5cdH0pO1xuXG59KShqUXVlcnkpO1xuIiwiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuXG5cbmZ1bmN0aW9uIHdlYmF1dGhuQXV0aGVudGljYXRlKGtleSwgY2Ipe1xuXHR2YXIgcGsgPSBKU09OLnBhcnNlKGtleSk7XG5cdHZhciBvcmlnaW5hbENoYWxsZW5nZSA9IHBrLmNoYWxsZW5nZTtcblx0cGsuY2hhbGxlbmdlID0gbmV3IFVpbnQ4QXJyYXkocGsuY2hhbGxlbmdlKTtcblx0cGsuYWxsb3dDcmVkZW50aWFscy5mb3JFYWNoKGZ1bmN0aW9uKGssIGlkeCl7XG5cdFx0cGsuYWxsb3dDcmVkZW50aWFsc1tpZHhdLmlkID0gbmV3IFVpbnQ4QXJyYXkoay5pZCk7XG5cdH0pO1xuXHQvKiBhc2sgdGhlIGJyb3dzZXIgdG8gcHJvbXB0IHRoZSB1c2VyICovXG5cdG5hdmlnYXRvci5jcmVkZW50aWFscy5nZXQoe3B1YmxpY0tleTogcGt9KVxuXHRcdC50aGVuKGZ1bmN0aW9uKGFBc3NlcnRpb24pIHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKFwiQ3JlZGVudGlhbHMuR2V0IHJlc3BvbnNlOiBcIiwgYUFzc2VydGlvbik7XG5cdFx0XHR2YXIgaWRhID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7IGlkYS5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBjZCA9IEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCAgbmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpKTtcblx0XHRcdHZhciBjZGEgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhQXNzZXJ0aW9uLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgY2RhLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGFkID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5hdXRoZW50aWNhdG9yRGF0YSkpLmZvckVhY2goZnVuY3Rpb24odil7IGFkLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIHNpZyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2Uuc2lnbmF0dXJlKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgc2lnLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGluZm8gPSB7XG5cdFx0XHRcdHR5cGU6IGFBc3NlcnRpb24udHlwZSxcblx0XHRcdFx0b3JpZ2luYWxDaGFsbGVuZ2U6IG9yaWdpbmFsQ2hhbGxlbmdlLFxuXHRcdFx0XHRyYXdJZDogaWRhLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF1dGhlbnRpY2F0b3JEYXRhOiBhZCxcblx0XHRcdFx0XHRjbGllbnREYXRhOiBjZCxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTmFycmF5OiBjZGEsXG5cdFx0XHRcdFx0c2lnbmF0dXJlOiBzaWdcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNiKHRydWUsIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcblx0XHR9KVxuXHRcdC5jYXRjaChmdW5jdGlvbiAoYUVycikge1xuXHRcdFx0aWYgKChcIm5hbWVcIiBpbiBhRXJyKSAmJiAoYUVyci5uYW1lID09IFwiQWJvcnRFcnJvclwiIHx8IGFFcnIubmFtZSA9PSBcIk5TX0VSUk9SX0FCT1JUXCIgfHxcblx0XHRcdFx0XHRcdFx0XHRcdCBhRXJyLm5hbWUgPT0gXCJOb3RBbGxvd2VkRXJyb3JcIikpIHtcblx0XHRcdFx0Y2IoZmFsc2UsICdhYm9ydCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2IoZmFsc2UsIGFFcnIudG9TdHJpbmcoKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG59XG5cbmZ1bmN0aW9uIHdlYmF1dGhuUmVnaXN0ZXIoa2V5LCBjYWxsYmFjayl7XG5cdGtleSA9IEpTT04ucGFyc2Uoa2V5KTtcblx0a2V5LnB1YmxpY0tleS5hdHRlc3RhdGlvbiA9IHVuZGVmaW5lZDtcblx0a2V5LnB1YmxpY0tleS5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheShrZXkucHVibGljS2V5LmNoYWxsZW5nZSk7IC8vIGNvbnZlcnQgdHlwZSBmb3IgdXNlIGJ5IGtleVxuXHRrZXkucHVibGljS2V5LnVzZXIuaWQgPSBuZXcgVWludDhBcnJheShrZXkucHVibGljS2V5LnVzZXIuaWQpO1xuXG5cdC8vIGNvbnNvbGUubG9nKGtleSk7XG5cdG5hdmlnYXRvci5jcmVkZW50aWFscy5jcmVhdGUoe3B1YmxpY0tleToga2V5LnB1YmxpY0tleX0pXG5cdFx0LnRoZW4oZnVuY3Rpb24gKGFOZXdDcmVkZW50aWFsSW5mbykge1xuXHRcdFx0Ly8gY29uc29sZS5sb2coXCJDcmVkZW50aWFscy5DcmVhdGUgcmVzcG9uc2U6IFwiLCBhTmV3Q3JlZGVudGlhbEluZm8pO1xuXHRcdFx0dmFyIGNkID0gSlNPTi5wYXJzZShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpKTtcblx0XHRcdGlmIChrZXkuYjY0Y2hhbGxlbmdlICE9IGNkLmNoYWxsZW5nZSkge1xuXHRcdFx0XHRjYWxsYmFjayhmYWxzZSwgJ2tleSByZXR1cm5lZCBzb21ldGhpbmcgdW5leHBlY3RlZCAoMSknKTtcblx0XHRcdH1cblx0XHRcdGlmICgnaHR0cHM6Ly8nK2tleS5wdWJsaWNLZXkucnAubmFtZSAhPSBjZC5vcmlnaW4pIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgyKScpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCEgKCd0eXBlJyBpbiBjZCkpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgzKScpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKGNkLnR5cGUgIT0gJ3dlYmF1dGhuLmNyZWF0ZScpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICg0KScpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgYW8gPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmVzcG9uc2UuYXR0ZXN0YXRpb25PYmplY3QpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpe1xuXHRcdFx0XHRhby5wdXNoKHYpO1xuXHRcdFx0fSk7XG5cdFx0XHR2YXIgcmF3SWQgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmF3SWQpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpe1xuXHRcdFx0XHRyYXdJZC5wdXNoKHYpO1xuXHRcdFx0fSk7XG5cdFx0XHR2YXIgaW5mbyA9IHtcblx0XHRcdFx0cmF3SWQ6IHJhd0lkLFxuXHRcdFx0XHRpZDogYU5ld0NyZWRlbnRpYWxJbmZvLmlkLFxuXHRcdFx0XHR0eXBlOiBhTmV3Q3JlZGVudGlhbEluZm8udHlwZSxcblx0XHRcdFx0cmVzcG9uc2U6IHtcblx0XHRcdFx0XHRhdHRlc3RhdGlvbk9iamVjdDogYW8sXG5cdFx0XHRcdFx0Y2xpZW50RGF0YUpTT046XG5cdFx0XHRcdFx0ICBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYU5ld0NyZWRlbnRpYWxJbmZvLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkpXG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHRjYWxsYmFjayh0cnVlLCBKU09OLnN0cmluZ2lmeShpbmZvKSk7XG5cdFx0fSlcblx0XHQuY2F0Y2goZnVuY3Rpb24gKGFFcnIpIHtcblx0XHRcdGlmIChcblx0XHRcdFx0KFwibmFtZVwiIGluIGFFcnIpICYmIChhRXJyLm5hbWUgPT0gXCJBYm9ydEVycm9yXCIgfHwgYUVyci5uYW1lID09IFwiTlNfRVJST1JfQUJPUlRcIilcblx0XHRcdFx0fHwgYUVyci5uYW1lID09ICdOb3RBbGxvd2VkRXJyb3InXG5cdFx0XHQpIHtcblx0XHRcdFx0Y2FsbGJhY2soZmFsc2UsICdhYm9ydCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2soZmFsc2UsIGFFcnIudG9TdHJpbmcoKSk7XG5cdFx0XHR9XG5cdFx0fSk7XG59XG5cbi8qKlxuICpcdEBwYXJhbSBBcnJheUJ1ZmZlciBhcnJheUJ1ZlxuICpcdEByZXR1cm4gQXJyYXlcbiAqL1xuY29uc3QgYnVmZmVyMkFycmF5ID0gYXJyYXlCdWYgPT4gWyAuLi4gKG5ldyBVaW50OEFycmF5KCBhcnJheUJ1ZiApKSBdO1xuXG5jb25zdCByZWdpc3RlciA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuUmVnaXN0ZXIoIHBheWxvYWQsIChzdWNjZXNzLGluZm8pID0+IHtcblx0XHQkLmFqYXgoe1xuXHRcdFx0dXJsOiB3cC5hamF4LnNldHRpbmdzLnVybCxcblx0XHRcdG1ldGhvZDogJ3Bvc3QnLFxuXHRcdFx0ZGF0YToge1xuXHRcdFx0XHRhY3Rpb246ICd3ZWJhdXRobi1yZWdpc3RlcicsXG5cdFx0XHRcdHBheWxvYWQ6IGluZm8sXG5cdFx0XHRcdF93cG5vbmNlOiBvcHRzLl93cG5vbmNlXG5cdFx0XHR9LFxuXHRcdFx0c3VjY2VzczogY2FsbGJhY2tcblx0XHR9KVxuXHR9KVxufVxuXG5cbmNvbnN0IGxvZ2luID0gKCBvcHRzLCBjYWxsYmFjayApID0+IHtcblxuXHRjb25zdCB7IGFjdGlvbiwgcGF5bG9hZCwgX3dwbm9uY2UgfSA9IG9wdHM7XG5cblx0d2ViYXV0aG5BdXRoZW50aWNhdGUoIHBheWxvYWQsIChzdWNjZXNzLGluZm8pID0+IHtcblx0XHRjYWxsYmFjayggeyBzdWNjZXNzLCByZXN1bHQ6IGluZm8gfSApXG5cdH0pXG59XG5cbmNvbnN0IGRlbGV0ZUtleSA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdCQuYWpheCh7XG5cdFx0dXJsOiB3cC5hamF4LnNldHRpbmdzLnVybCxcblx0XHRtZXRob2Q6ICdwb3N0Jyxcblx0XHRkYXRhOiB7XG5cdFx0XHRhY3Rpb246IGFjdGlvbixcblx0XHRcdHBheWxvYWQ6IGluZm8sXG5cdFx0XHRfd3Bub25jZTogX3dwbm9uY2Vcblx0XHR9LFxuXHRcdHN1Y2Nlc3M6Y2FsbGJhY2tcblx0fSlcbn1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0cmVnaXN0ZXIsIGxvZ2luLCBkZWxldGVLZXlcbn1cbiJdfQ==