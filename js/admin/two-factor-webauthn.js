!function(){var e={};(function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r="credentials"in navigator;e={register:function(e,t){var n=e.action,r=e.user_id,s=e.payload,i=e._wpnonce;!function(e,t){var n=Object.assign({},e.publicKey);n.attestation=void 0,n.challenge=new Uint8Array(n.challenge),n.user.id=new Uint8Array(n.user.id),navigator.credentials.create({publicKey:n}).then(function(n){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)));if(e.b64challenge!==a.challenge&&t(!1,"key returned something unexpected (1)"),!("type"in a))return t(!1,"key returned something unexpected (3)");if("webauthn.create"!=a.type)return t(!1,"key returned something unexpected (4)");var r=[];new Uint8Array(n.response.attestationObject).forEach(function(e){r.push(e)});var s=[];new Uint8Array(n.rawId).forEach(function(e){s.push(e)});var i={rawId:s,id:n.id,type:n.type,response:{attestationObject:r,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)))}};t(!0,JSON.stringify(i))}).catch(function(e){t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(s,function(e,s){e?a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:s,user_id:r,_wpnonce:i},success:t}):t({success:!1,message:s})})},login:function(e,t){e.action;var n=e.payload;e._wpnonce,function(e,t){var n=e.challenge,a=Object.assign({},e);a.challenge=new Uint8Array(e.challenge),a.allowCredentials=a.allowCredentials.map(function(e){var t=Object.assign({},e);return t.id=new Uint8Array(e.id),t}),navigator.credentials.get({publicKey:a}).then(function(e){var a=[];new Uint8Array(e.rawId).forEach(function(e){a.push(e)});var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON))),s=[];new Uint8Array(e.response.clientDataJSON).forEach(function(e){s.push(e)});var i=[];new Uint8Array(e.response.authenticatorData).forEach(function(e){i.push(e)});var o=[];new Uint8Array(e.response.signature).forEach(function(e){o.push(e)});var u={type:e.type,originalChallenge:n,rawId:a,response:{authenticatorData:i,clientData:r,clientDataJSONarray:s,signature:o}};t(!0,JSON.stringify(u))}).catch(function(e){console.log(e),t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(n,function(e,n){t(e?{success:!0,result:n}:{success:!1,message:n})})},sendRequest:function(e,t){a.default.ajax({url:wp.ajax.settings.url,method:"post",data:e,success:t})},isWebauthnSupported:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r=function(t,n){var r=n.action,s=n.payload,i=n._wpnonce,o=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=(0,a.default)(t).text();(0,a.default)(t).text(o),(0,a.default)(t).prop("contenteditable",!1),(0,a.default)(document).off("keydown"),(0,a.default)(t).off("blur"),n&&u!==o?((0,a.default)(t).addClass("busy"),(0,e.sendRequest)({action:r,payload:{md5id:s,label:o},_wpnonce:i},function(e){(0,a.default)(t).removeClass("busy")})):n||(0,a.default)(t).text(u)},u=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!0),(0,a.default)(document).on("keydown",function(e){13===e.which?(o(!0),e.preventDefault()):27===e.which&&o(!0)}),(0,a.default)(t).on("blur",function(e){return o(!0)}).on("paste",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}),(0,a.default)(t).focus(),document.execCommand("selectAll",!1,null)};(0,a.default)(document).on("click","#webauthn-register-key",function(t){t.preventDefault(),(0,a.default)(t.target).next(".webauthn-error").remove();var n=(0,a.default)(t.target).addClass("busy"),s=JSON.parse((0,a.default)(t.target).attr("data-create-options"));(0,e.register)(s,function(e){if(n.removeClass("busy"),e.success){var t=(0,a.default)(e.html).appendTo("#webauthn-keys").find(".webauthn-label");r(t.get(0),JSON.parse(t.attr("data-action")))}else{var s;s=e.message?e.message:e.data&&e.data[0]&&e.data[0].message?e.data[0].message:JSON.stringify(e),(0,a.default)('<span class="webauthn-error description">'.concat(s,"</span>")).insertAfter("#webauthn-register-key")}})}),e.isWebauthnSupported?(0,a.default)(document).on("click",".webauthn-action",function(t){t.preventDefault();var n=(0,a.default)(t.target).closest(".webauthn-action"),s=JSON.parse(n.attr("data-action")),i=(0,a.default)(t.target).closest(".webauthn-key"),o=s.action,u=s.user_id,d=(s.payload,s._wpnonce);"webauthn-test-key"===o?(t.preventDefault(),i.find(".notice").remove(),n.addClass("busy"),(0,e.login)(s,function(t){if(!t.success)return i.append('<div class="notice notice-inline notice-warning">'.concat(t.message,"</div>")),void n.removeClass("busy");console.log({action:o,user_id:u,payload:t.result,_wpnonce:d}),(0,e.sendRequest)({action:o,user_id:u,payload:t.result,_wpnonce:d},function(e){e.success?n.find("[data-tested]").attr("data-tested","tested"):(n.find("[data-tested]").attr("data-tested","fail"),i.append('<div class="notice notice-inline notice-error">'.concat(e.message,"</div>"))),n.removeClass("busy")})})):"webauthn-delete-key"===o&&(i.addClass("busy"),t.preventDefault(),(0,e.sendRequest)(s,function(e){i.removeClass("busy"),e.success?i.remove():i.append('<div class="notice notice-inline notice-error">'.concat(e.data[0].message,"</div>"))})),"webauthn-edit-key"===s.action&&"true"!==(0,a.default)(t.currentTarget).prop("contenteditable")&&(t.preventDefault(),r(t.currentTarget,s))}):((0,a.default)(".webauthn-unsupported").removeClass("hidden"),(0,a.default)(".webauthn-supported").addClass("hidden"))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2stZmxhdC9fcHJlbHVkZSIsInNyYy9qcy9saWIvZGF2aWRlYXJsLXdlYmF1dGhuLmpzIiwic3JjL2pzL2FkbWluL3R3by1mYWN0b3Itd2ViYXV0aG4vaW5kZXguanMiXSwibmFtZXMiOlsiXyRkYXZpZGVhcmxXZWJhdXRobl8yIiwib2JqIiwiX2pxdWVyeSIsIndpbmRvdyIsImpRdWVyeSIsImdsb2JhbCIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiaXNXZWJhdXRoblN1cHBvcnRlZCIsIm5hdmlnYXRvciIsInJlZ2lzdGVyIiwib3B0cyIsImNhbGxiYWNrIiwiYWN0aW9uIiwidXNlcl9pZCIsInBheWxvYWQiLCJfd3Bub25jZSIsImtleSIsInB1YmxpY0tleSIsIk9iamVjdCIsImFzc2lnbiIsImF0dGVzdGF0aW9uIiwiY2hhbGxlbmdlIiwiVWludDhBcnJheSIsInVzZXIiLCJpZCIsImNyZWRlbnRpYWxzIiwiY3JlYXRlIiwidGhlbiIsImFOZXdDcmVkZW50aWFsSW5mbyIsImNkIiwiSlNPTiIsInBhcnNlIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiYXBwbHkiLCJyZXNwb25zZSIsImNsaWVudERhdGFKU09OIiwiYjY0Y2hhbGxlbmdlIiwidHlwZSIsImFvIiwiYXR0ZXN0YXRpb25PYmplY3QiLCJmb3JFYWNoIiwidiIsInB1c2giLCJyYXdJZCIsImluZm8iLCJzdHJpbmdpZnkiLCJjYXRjaCIsImVyciIsIm5hbWUiLCJtZXNzYWdlIiwidG9TdHJpbmciLCJzdWNjZXNzIiwiYWpheCIsInVybCIsIndwIiwic2V0dGluZ3MiLCJtZXRob2QiLCJkYXRhIiwibG9naW4iLCJwdWJLZXlBdXRoIiwib3JpZ2luYWxDaGFsbGVuZ2UiLCJwayIsImFsbG93Q3JlZGVudGlhbHMiLCJtYXAiLCJrIiwicmV0IiwiZ2V0IiwiYUFzc2VydGlvbiIsImlkYSIsImNkYSIsImFkIiwiYXV0aGVudGljYXRvckRhdGEiLCJzaWciLCJzaWduYXR1cmUiLCJjbGllbnREYXRhIiwiY2xpZW50RGF0YUpTT05hcnJheSIsImNvbnNvbGUiLCJsb2ciLCJyZXN1bHQiLCJzZW5kUmVxdWVzdCIsImVkaXRLZXkiLCJlZGl0TGFiZWwiLCJzdG9wRWRpdGluZyIsInNhdmUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJuZXdMYWJlbCIsInRleHQiLCJwcm9wIiwiZG9jdW1lbnQiLCJvZmYiLCJwcmV2TGFiZWwiLCJhZGRDbGFzcyIsIm1kNWlkIiwibGFiZWwiLCJyZW1vdmVDbGFzcyIsIm9uIiwiZSIsIndoaWNoIiwicHJldmVudERlZmF1bHQiLCJvcmlnaW5hbEV2ZW50IiwiY2xpcGJvYXJkRGF0YSIsImdldERhdGEiLCJleGVjQ29tbWFuZCIsImZvY3VzIiwidGFyZ2V0IiwibmV4dCIsInJlbW92ZSIsIiRidG4iLCJhdHRyIiwiJGtleUxhYmVsIiwiaHRtbCIsImFwcGVuZFRvIiwiZmluZCIsIm1zZyIsImNvbmNhdCIsImluc2VydEFmdGVyIiwiY2xvc2VzdCIsIiRrZXlFbCIsImFwcGVuZCIsImN1cnJlbnRUYXJnZXQiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsSUFBQUEsRUFBQSw2QkNEQSxJQUFBQyxFQUFBQyxHQUFBRCxFQUFBLG9CQUFBRSxPQUFBQSxPQUFBQyxZQUFBLElBQUFDLEVBQUFBLEVBQUFELE9BQUEsT0FBQUgsRUFBQUssV0FBQUwsRUFBQSxDQUFBTSxRQUFBTixHQStMTU8sRUFBc0IsZ0JBQWlCQyxVQUU3Q1QsRUFBaUIsQ0FDaEJVLFNBbkRnQixTQUFFQyxFQUFNQyxHQUFjLElBRTlCQyxFQUF1Q0YsRUFBdkNFLE9BQVFDLEVBQStCSCxFQUEvQkcsUUFBU0MsRUFBc0JKLEVBQXRCSSxRQUFTQyxFQUFhTCxFQUFiSyxVQS9EbkMsU0FBMkJDLEVBQUtMLEdBRS9CLElBQUlNLEVBQVlDLE9BQU9DLE9BQVEsR0FBSUgsRUFBSUMsV0FFdkNBLEVBQVVHLGlCQUFBLEVBQ1ZILEVBQVVJLFVBQVksSUFBSUMsV0FBWUwsRUFBVUksV0FD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Q2Q5RixFQUFBNEQsT0FBT2pELEVBQU0sU0FBQXFFLEdBRVosSUFBT0EsRUFBTzNCLFFBR2IsT0FGQW1FLEVBQU9DLE9BQVAsb0RBQUFKLE9BQWtFckMsRUFBTzdCLFFBQXpFLGdCQUNBMkQsRUFBS2IsWUFBWSxRQUdsQm5CLFFBQVFDLElBQUksQ0FBRWxFLE9BQUFBLEVBQVFDLFFBQUFBLEVBQVNDLFFBQVNpRSxFQUFPQSxPQUFRaEUsU0FBQUEsS0FBQSxFQUN2RGhCLEVBQUFpRixhQUFhLENBQUVwRSxPQUFBQSxFQUFRQyxRQUFBQSxFQUFTQyxRQUFTaUUsRUFBT0EsT0FBUWhFLFNBQUFBLEdBQVksU0FBQW9CLEdBQzlEQSxFQUFTaUIsUUFDYnlELEVBQUtLLEtBQUssaUJBQWlCSixLQUFLLGNBQWMsV0FFOUNELEVBQUtLLEtBQUssaUJBQWlCSixLQUFLLGNBQWMsUUFDOUNTLEVBQU9DLE9BQVAsa0RBQUFKLE9BQWdFakYsRUFBU2UsUUFBekUsWUFFRDJELEVBQUtiLFlBQVksYUFHRyx3QkFBWHBGLElBQ1gyRyxFQUFPMUIsU0FBUyxRQUNoQkssRUFBRUUsa0JBQUEsRUFDRnJHLEVBQUFpRixhQUFhdEUsRUFBTSxTQUFVeUIsR0FDNUJvRixFQUFPdkIsWUFBWSxRQUVkN0QsRUFBU2lCLFFBQ2JtRSxFQUFPWCxTQUdQVyxFQUFPQyxPQUFQLGtEQUFBSixPQUFnRWpGLEVBQVN1QixLQUFLLEdBQUdSLFFBQWpGLGNBR29CLHNCQUFoQnhDLEVBQUtFLFFBQ04sVUFBQSxFQUFXWCxFQUFBSyxTQUFFNEYsRUFBRXVCLGVBQWVoQyxLQUFNLHFCQUN4Q1MsRUFBRUUsaUJBQ0ZuQixFQUFTaUIsRUFBRXVCLGNBQWUvRyxRQUFBLEVBSzdCVCxFQUFBSyxTQUFFLHlCQUF5QjBGLFlBQVksV0FBQSxFQUN2Qy9GLEVBQUFLLFNBQUUsdUJBQXVCdUYsU0FBUyw0SEZ0Sm5DIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XG4iLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknXG5cblxuXG5cbi8qKlxuICpcdFN0b2xlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXZpZGVhcmwvd2ViYXV0aG5cbiAqL1xuZnVuY3Rpb24gd2ViYXV0aG5BdXRoZW50aWNhdGUoIHB1YktleUF1dGgsIGNhbGxiYWNrICkge1xuXG5cdGNvbnN0IG9yaWdpbmFsQ2hhbGxlbmdlID0gcHViS2V5QXV0aC5jaGFsbGVuZ2U7XG5cdGNvbnN0IHBrID0gT2JqZWN0LmFzc2lnbigge30sIHB1YktleUF1dGggKVxuXG5cdHBrLmNoYWxsZW5nZSA9IG5ldyBVaW50OEFycmF5KCBwdWJLZXlBdXRoLmNoYWxsZW5nZSApXG5cdHBrLmFsbG93Q3JlZGVudGlhbHMgPSBway5hbGxvd0NyZWRlbnRpYWxzLm1hcCggayA9PiB7XG5cdFx0bGV0IHJldCA9IE9iamVjdC5hc3NpZ24oIHt9LCBrIClcblx0XHRyZXQuaWQgPSBuZXcgVWludDhBcnJheShrLmlkKTtcblx0XHRyZXR1cm4gcmV0XG5cdH0gKVxuXG5cdC8qIGFzayB0aGUgYnJvd3NlciB0byBwcm9tcHQgdGhlIHVzZXIgKi9cblx0bmF2aWdhdG9yLmNyZWRlbnRpYWxzLmdldCggeyBwdWJsaWNLZXk6IHBrIH0gKVxuXHRcdC50aGVuKCBhQXNzZXJ0aW9uID0+IHtcblx0XHRcdC8vIGNvbnNvbGUubG9nKFwiQ3JlZGVudGlhbHMuR2V0IHJlc3BvbnNlOiBcIiwgYUFzc2VydGlvbik7XG5cdFx0XHR2YXIgaWRhID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7IGlkYS5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBjZCA9IEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCAgbmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpKTtcblx0XHRcdHZhciBjZGEgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhQXNzZXJ0aW9uLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgY2RhLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGFkID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5hdXRoZW50aWNhdG9yRGF0YSkpLmZvckVhY2goZnVuY3Rpb24odil7IGFkLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIHNpZyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2Uuc2lnbmF0dXJlKSkuZm9yRWFjaChmdW5jdGlvbih2KXsgc2lnLnB1c2godik7IH0pO1xuXHRcdFx0dmFyIGluZm8gPSB7XG5cdFx0XHRcdHR5cGU6IGFBc3NlcnRpb24udHlwZSxcblx0XHRcdFx0b3JpZ2luYWxDaGFsbGVuZ2U6IG9yaWdpbmFsQ2hhbGxlbmdlLFxuXHRcdFx0XHRyYXdJZDogaWRhLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF1dGhlbnRpY2F0b3JEYXRhOiBhZCxcblx0XHRcdFx0XHRjbGllbnREYXRhOiBjZCxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTmFycmF5OiBjZGEsXG5cdFx0XHRcdFx0c2lnbmF0dXJlOiBzaWdcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNhbGxiYWNrKCB0cnVlLCBKU09OLnN0cmluZ2lmeSggaW5mbyApICk7XG5cdFx0fSlcblx0XHQuY2F0Y2goIGVyciA9PiB7XG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpXG5cdFx0XHQvKlxuXHRcdFx0RkYgbWFjOlxuXHRcdFx0SW52YWxpZFN0YXRlRXJyb3I6IGtleSBub3QgZm91bmRcblx0XHRcdEFib3J0RXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogP1xuXHRcdFx0XHRUaGUgcmVxdWVzdCBpcyBub3QgYWxsb3dlZCBieSB0aGUgdXNlciBhZ2VudCBvciB0aGUgcGxhdGZvcm0gaW4gdGhlIGN1cnJlbnQgY29udGV4dCwgcG9zc2libHkgYmVjYXVzZSB0aGUgdXNlciBkZW5pZWQgcGVybWlzc2lvbi5cblxuXHRcdFx0Q2hyb21lIG1hYzpcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRTYWZhcmkgbWFjOlxuXHRcdFx0Tm90QWxsb3dlZEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cblx0XHRcdEVkZ2Ugd2luMTA6XG5cdFx0XHRVbmtub3duRXJyb3I6IHdyb25nIGtleS4uLj9cblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRGRiB3aW46XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblx0XHRcdFx0RE9NRXhjZXB0aW9uOiBcIlRoZSByZXF1ZXN0IGlzIG5vdCBhbGxvd2VkIGJ5IHRoZSB1c2VyIGFnZW50IG9yIHRoZSBwbGF0Zm9ybSBpbiB0aGUgY3VycmVudCBjb250ZXh0LCBwb3NzaWJseSBiZWNhdXNlIHRoZSB1c2VyIGRlbmllZCBwZXJtaXNzaW9uLlwiXG5cblx0XHRcdCovXG5cdFx0XHRpZiAoIFwibmFtZVwiIGluIGVyciApIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIubmFtZSArICc6ICcgKyBlcnIubWVzc2FnZSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIudG9TdHJpbmcoKSApO1xuXHRcdFx0fVxuXHRcdH0pO1xufVxuXG4vKipcbiAqXHRTdG9sZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRlYXJsL3dlYmF1dGhuXG4gKi9cbmZ1bmN0aW9uIHdlYmF1dGhuUmVnaXN0ZXIoIGtleSwgY2FsbGJhY2sgKXtcblxuXHRsZXQgcHVibGljS2V5ID0gT2JqZWN0LmFzc2lnbigge30sIGtleS5wdWJsaWNLZXkgKTtcblxuXHRwdWJsaWNLZXkuYXR0ZXN0YXRpb24gPSB1bmRlZmluZWQ7XG5cdHB1YmxpY0tleS5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LmNoYWxsZW5nZSApOyAvLyBjb252ZXJ0IHR5cGUgZm9yIHVzZSBieSBrZXlcblx0cHVibGljS2V5LnVzZXIuaWQgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LnVzZXIuaWQgKTtcblxuXHQvLyBjb25zb2xlLmxvZyhrZXkpO1xuXHRuYXZpZ2F0b3IuY3JlZGVudGlhbHMuY3JlYXRlKCB7IHB1YmxpY0tleSB9IClcblx0XHQudGhlbihmdW5jdGlvbiAoYU5ld0NyZWRlbnRpYWxJbmZvKSB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkNyZWRlbnRpYWxzLkNyZWF0ZSByZXNwb25zZTogXCIsIGFOZXdDcmVkZW50aWFsSW5mbyk7XG5cdFx0XHR2YXIgY2QgPSBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYU5ld0NyZWRlbnRpYWxJbmZvLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkpO1xuXHRcdFx0aWYgKCBrZXkuYjY0Y2hhbGxlbmdlICE9PSBjZC5jaGFsbGVuZ2UgKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgxKScpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gaWYgKCdodHRwczovLycra2V5LnB1YmxpY0tleS5ycC5uYW1lICE9IGNkLm9yaWdpbikge1xuXHRcdFx0Ly8gXHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDIpJyk7XG5cdFx0XHQvLyB9XG5cdFx0XHRpZiAoISAoJ3R5cGUnIGluIGNkKSkge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDMpJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoY2QudHlwZSAhPSAnd2ViYXV0aG4uY3JlYXRlJykge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDQpJyk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBhbyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yZXNwb25zZS5hdHRlc3RhdGlvbk9iamVjdCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdGFvLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciByYXdJZCA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdHJhd0lkLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciBpbmZvID0ge1xuXHRcdFx0XHRyYXdJZDogcmF3SWQsXG5cdFx0XHRcdGlkOiBhTmV3Q3JlZGVudGlhbEluZm8uaWQsXG5cdFx0XHRcdHR5cGU6IGFOZXdDcmVkZW50aWFsSW5mby50eXBlLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF0dGVzdGF0aW9uT2JqZWN0OiBhbyxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTjpcblx0XHRcdFx0XHQgIEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmVzcG9uc2UuY2xpZW50RGF0YUpTT04pKSlcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNhbGxiYWNrKHRydWUsIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcblx0XHR9KVxuXHRcdC5jYXRjaCggZXJyID0+IHtcblx0XHRcdGlmICggXCJuYW1lXCIgaW4gZXJyICkge1xuXHRcdFx0XHRjYWxsYmFjayggZmFsc2UsIGVyci5uYW1lICsgJzogJyArIGVyci5tZXNzYWdlICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjYWxsYmFjayggZmFsc2UsIGVyci50b1N0cmluZygpICk7XG5cdFx0XHR9XG5cdFx0fSk7XG59XG5cbi8qKlxuICpcdEBwYXJhbSBBcnJheUJ1ZmZlciBhcnJheUJ1ZlxuICpcdEByZXR1cm4gQXJyYXlcbiAqL1xuY29uc3QgYnVmZmVyMkFycmF5ID0gYXJyYXlCdWYgPT4gWyAuLi4gKG5ldyBVaW50OEFycmF5KCBhcnJheUJ1ZiApKSBdO1xuXG5jb25zdCByZWdpc3RlciA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHVzZXJfaWQsIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuUmVnaXN0ZXIoIHBheWxvYWQsIChzdWNjZXNzLGluZm8pID0+IHtcblx0XHRpZiAoIHN1Y2Nlc3MgKSB7XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6IHdwLmFqYXguc2V0dGluZ3MudXJsLFxuXHRcdFx0XHRtZXRob2Q6ICdwb3N0Jyxcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbixcblx0XHRcdFx0XHRwYXlsb2FkOiBpbmZvLFxuXHRcdFx0XHRcdHVzZXJfaWQsXG5cdFx0XHRcdFx0X3dwbm9uY2Vcblx0XHRcdFx0fSxcblx0XHRcdFx0c3VjY2VzczogY2FsbGJhY2tcblx0XHRcdH0pXG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbGxiYWNrKCB7IHN1Y2Nlc3M6ZmFsc2UsIG1lc3NhZ2U6aW5mbyB9IClcblx0XHR9XG5cdH0pXG59XG5cblxuY29uc3QgbG9naW4gPSAoIG9wdHMsIGNhbGxiYWNrICkgPT4ge1xuXG5cdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0cztcblxuXHR3ZWJhdXRobkF1dGhlbnRpY2F0ZSggcGF5bG9hZCwgKCBzdWNjZXNzLCBpbmZvICkgPT4ge1xuXHRcdGlmICggc3VjY2VzcyApIHtcblx0XHRcdGNhbGxiYWNrKCB7IHN1Y2Nlc3M6dHJ1ZSwgcmVzdWx0OiBpbmZvIH0gKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYWxsYmFjayggeyBzdWNjZXNzOmZhbHNlLCBtZXNzYWdlOiBpbmZvIH0gKVxuXHRcdH1cblxuXHR9KVxufVxuXG5jb25zdCBzZW5kUmVxdWVzdCA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0JC5hamF4KHtcblx0XHR1cmw6IHdwLmFqYXguc2V0dGluZ3MudXJsLFxuXHRcdG1ldGhvZDogJ3Bvc3QnLFxuXHRcdGRhdGE6IG9wdHMsXG5cdFx0c3VjY2VzczpjYWxsYmFja1xuXHR9KVxufVxuXG5jb25zdCBpc1dlYmF1dGhuU3VwcG9ydGVkID0gJ2NyZWRlbnRpYWxzJyBpbiBuYXZpZ2F0b3JcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdHJlZ2lzdGVyLFxuXHRsb2dpbixcblx0c2VuZFJlcXVlc3QsXG5cdGlzV2ViYXV0aG5TdXBwb3J0ZWRcbn1cbiIsImltcG9ydCAkIGZyb20gJ2pxdWVyeSdcbmltcG9ydCB7IHJlZ2lzdGVyLCBsb2dpbiwgc2VuZFJlcXVlc3QsIGlzV2ViYXV0aG5TdXBwb3J0ZWQgfSBmcm9tICdkYXZpZGVhcmwtd2ViYXV0aG4nXG5cblxuXG5jb25zdCBlZGl0S2V5ID0gKCBlZGl0TGFiZWwsIG9wdHMgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzXG5cblxuXHQvLyBjb25zb2xlLmxvZygkZWRpdExhYmVsLnByb3AoICdjb250ZW50ZWRpdGFibGUnICkpO1xuXHRjb25zdCBzdG9wRWRpdGluZyA9ICggc2F2ZSA9IGZhbHNlICkgPT4ge1xuXHRcdGxldCBuZXdMYWJlbCA9ICQoZWRpdExhYmVsKS50ZXh0KClcblx0XHQkKGVkaXRMYWJlbCkudGV4dChuZXdMYWJlbClcblx0XHQkKGVkaXRMYWJlbCkucHJvcCggJ2NvbnRlbnRlZGl0YWJsZScsIGZhbHNlICk7XG5cdFx0JChkb2N1bWVudCkub2ZmKCAna2V5ZG93bicgKVxuXHRcdCQoZWRpdExhYmVsKS5vZmYoICdibHVyJyApXG5cdFx0aWYgKCBzYXZlICYmIHByZXZMYWJlbCAhPT0gbmV3TGFiZWwgKSB7XG5cdFx0XHQkKGVkaXRMYWJlbCkuYWRkQ2xhc3MoJ2J1c3knKVxuXG5cdFx0XHRzZW5kUmVxdWVzdChcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGFjdGlvbixcblx0XHRcdFx0XHRwYXlsb2FkOiB7IG1kNWlkOiBwYXlsb2FkLCBsYWJlbDogbmV3TGFiZWwgfSxcblx0XHRcdFx0XHRfd3Bub25jZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0JChlZGl0TGFiZWwpLnJlbW92ZUNsYXNzKCdidXN5Jylcblx0XHRcdFx0fVxuXHRcdFx0KTtcblx0XHR9IGVsc2UgaWYgKCAhIHNhdmUgKSB7XG5cdFx0XHQkKGVkaXRMYWJlbCkudGV4dChwcmV2TGFiZWwpXG5cdFx0fVxuXHR9XG5cblx0Y29uc3QgcHJldkxhYmVsID0gJChlZGl0TGFiZWwpLnRleHQoKVxuXG5cdCQoZWRpdExhYmVsKS5wcm9wKCAnY29udGVudGVkaXRhYmxlJywgdHJ1ZSApO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCAna2V5ZG93bicsIGUgPT4ge1xuXHRcdGlmICggZS53aGljaCA9PT0gMTMgKSB7XG5cdFx0XHRzdG9wRWRpdGluZyggdHJ1ZSApXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHR9IGVsc2UgaWYgKCBlLndoaWNoID09PSAyNyApIHtcblx0XHRcdHN0b3BFZGl0aW5nKCB0cnVlIClcblx0XHR9XG5cdH0gKVxuXG5cdC8vIGZvY3VzIGFuZCBzZWxlY3Rcblx0JChlZGl0TGFiZWwpXG5cdFx0Lm9uKCAnYmx1cicsIGUgPT4gc3RvcEVkaXRpbmcoIHRydWUgKSApXG5cdFx0Lm9uKCAncGFzdGUnLCBlID0+IHtcblx0XHQgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdCAgICBsZXQgdGV4dCA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG5cdFx0ICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiaW5zZXJ0SFRNTFwiLCBmYWxzZSwgdGV4dCk7XG5cdFx0fSApXG5cblx0JChlZGl0TGFiZWwpLmZvY3VzKClcblxuXHRkb2N1bWVudC5leGVjQ29tbWFuZCggJ3NlbGVjdEFsbCcsIGZhbHNlLCBudWxsICk7XG5cbn1cblxuJChkb2N1bWVudCkub24oICdjbGljaycsICcjd2ViYXV0aG4tcmVnaXN0ZXIta2V5JywgZSA9PiB7XG5cblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdCQoZS50YXJnZXQpLm5leHQoJy53ZWJhdXRobi1lcnJvcicpLnJlbW92ZSgpXG5cblx0bGV0ICRidG4gPSAkKGUudGFyZ2V0KS5hZGRDbGFzcygnYnVzeScpXG5cblx0Y29uc3Qgb3B0cyA9IEpTT04ucGFyc2UoICQoZS50YXJnZXQpLmF0dHIoJ2RhdGEtY3JlYXRlLW9wdGlvbnMnKSApO1xuXG5cdHJlZ2lzdGVyKCBvcHRzLCByZXNwb25zZSA9PiB7XG5cdFx0JGJ0bi5yZW1vdmVDbGFzcygnYnVzeScpXG5cdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0bGV0ICRrZXlJdGVtID0gJChyZXNwb25zZS5odG1sKS5hcHBlbmRUbygnI3dlYmF1dGhuLWtleXMnKVxuXHRcdFx0bGV0ICRrZXlMYWJlbCA9ICRrZXlJdGVtLmZpbmQoJy53ZWJhdXRobi1sYWJlbCcpXG5cblx0XHRcdGVkaXRLZXkoXG5cdFx0XHRcdCRrZXlMYWJlbC5nZXQoMCksXG5cdFx0XHRcdEpTT04ucGFyc2UoICRrZXlMYWJlbC5hdHRyKCdkYXRhLWFjdGlvbicpIClcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxldCBtc2c7XG5cdFx0XHRpZiAoICEhIHJlc3BvbnNlLm1lc3NhZ2UgKSB7XG5cdFx0XHRcdG1zZyA9IHJlc3BvbnNlLm1lc3NhZ2U7XG5cdFx0XHR9IGVsc2UgaWYgKCAhISByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGFbMF0gJiYgcmVzcG9uc2UuZGF0YVswXS5tZXNzYWdlICkge1xuXHRcdFx0XHRtc2cgPSByZXNwb25zZS5kYXRhWzBdLm1lc3NhZ2U7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRtc2cgPSBKU09OLnN0cmluZ2lmeShyZXNwb25zZSlcblx0XHRcdH1cblx0XHRcdCQoYDxzcGFuIGNsYXNzPVwid2ViYXV0aG4tZXJyb3IgZGVzY3JpcHRpb25cIj4ke21zZ308L3NwYW4+YCkuaW5zZXJ0QWZ0ZXIoJyN3ZWJhdXRobi1yZWdpc3Rlci1rZXknKVxuXHRcdH1cblx0fSk7XG5cbn0pO1xuXG5pZiAoIGlzV2ViYXV0aG5TdXBwb3J0ZWQgKSB7XG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsJy53ZWJhdXRobi1hY3Rpb24nLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0Y29uc3QgJGJ0biA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy53ZWJhdXRobi1hY3Rpb24nKTtcblx0XHRjb25zdCBvcHRzID0gSlNPTi5wYXJzZSggJGJ0bi5hdHRyKCdkYXRhLWFjdGlvbicpICk7XG5cdFx0Y29uc3QgJGtleUVsID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLndlYmF1dGhuLWtleScpXG5cdFx0Y29uc3QgeyBhY3Rpb24sIHVzZXJfaWQsIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzXG5cblx0XHRpZiAoIGFjdGlvbiA9PT0gJ3dlYmF1dGhuLXRlc3Qta2V5JyApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdCRrZXlFbC5maW5kKCcubm90aWNlJykucmVtb3ZlKCk7XG5cdFx0XHQkYnRuLmFkZENsYXNzKCdidXN5Jyk7XG5cdFx0XHRsb2dpbiggb3B0cywgcmVzdWx0ID0+IHtcblx0XHRcdFx0Ly8gc2VuZCB0aGF0IGNyYXAgdG8gc2VydmVyXG5cdFx0XHRcdGlmICggISByZXN1bHQuc3VjY2VzcyApIHtcblx0XHRcdFx0XHQka2V5RWwuYXBwZW5kKGA8ZGl2IGNsYXNzPVwibm90aWNlIG5vdGljZS1pbmxpbmUgbm90aWNlLXdhcm5pbmdcIj4ke3Jlc3VsdC5tZXNzYWdlfTwvZGl2PmApXG5cdFx0XHRcdFx0JGJ0bi5yZW1vdmVDbGFzcygnYnVzeScpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25zb2xlLmxvZyh7IGFjdGlvbiwgdXNlcl9pZCwgcGF5bG9hZDogcmVzdWx0LnJlc3VsdCwgX3dwbm9uY2UgfSlcblx0XHRcdFx0c2VuZFJlcXVlc3QoIHsgYWN0aW9uLCB1c2VyX2lkLCBwYXlsb2FkOiByZXN1bHQucmVzdWx0LCBfd3Bub25jZSB9LCByZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0XHRcdFx0JGJ0bi5maW5kKCdbZGF0YS10ZXN0ZWRdJykuYXR0cignZGF0YS10ZXN0ZWQnLCd0ZXN0ZWQnKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQkYnRuLmZpbmQoJ1tkYXRhLXRlc3RlZF0nKS5hdHRyKCdkYXRhLXRlc3RlZCcsJ2ZhaWwnKVxuXHRcdFx0XHRcdFx0JGtleUVsLmFwcGVuZChgPGRpdiBjbGFzcz1cIm5vdGljZSBub3RpY2UtaW5saW5lIG5vdGljZS1lcnJvclwiPiR7cmVzcG9uc2UubWVzc2FnZX08L2Rpdj5gKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQkYnRuLnJlbW92ZUNsYXNzKCdidXN5Jyk7XG5cdFx0XHRcdH0pXG5cdFx0XHR9ICk7XG5cdFx0fSBlbHNlIGlmICggYWN0aW9uID09PSAnd2ViYXV0aG4tZGVsZXRlLWtleScgKSB7XG5cdFx0XHQka2V5RWwuYWRkQ2xhc3MoJ2J1c3knKTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdHNlbmRSZXF1ZXN0KCBvcHRzLCBmdW5jdGlvbiggcmVzcG9uc2UgKSB7XG5cdFx0XHRcdCRrZXlFbC5yZW1vdmVDbGFzcygnYnVzeScpO1xuXHRcdFx0XHQvLyByZW1vdmVcblx0XHRcdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0XHRcdCRrZXlFbC5yZW1vdmUoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBlcnJvciBmcm9tIHNlcnZlclxuXHRcdFx0XHRcdCRrZXlFbC5hcHBlbmQoYDxkaXYgY2xhc3M9XCJub3RpY2Ugbm90aWNlLWlubGluZSBub3RpY2UtZXJyb3JcIj4ke3Jlc3BvbnNlLmRhdGFbMF0ubWVzc2FnZX08L2Rpdj5gKVxuXHRcdFx0XHR9XG5cdFx0XHR9ICk7XG5cdFx0fSBpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tZWRpdC1rZXknICkge1xuXHRcdFx0aWYgKCAndHJ1ZScgIT09ICQoZS5jdXJyZW50VGFyZ2V0KS5wcm9wKCAnY29udGVudGVkaXRhYmxlJyApICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGVkaXRLZXkoIGUuY3VycmVudFRhcmdldCwgb3B0cyApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59IGVsc2Uge1xuXHQkKCcud2ViYXV0aG4tdW5zdXBwb3J0ZWQnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG5cdCQoJy53ZWJhdXRobi1zdXBwb3J0ZWQnKS5hZGRDbGFzcygnaGlkZGVuJyk7XG59XG4iXX0=