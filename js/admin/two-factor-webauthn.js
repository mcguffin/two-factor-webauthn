!function(){var e={};(function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r="credentials"in navigator;e={register:function(e,t){var n=e.action,o=e.payload,r=e._wpnonce;!function(e,t){var n=Object.assign({},e.publicKey);n.attestation=void 0,n.challenge=new Uint8Array(n.challenge),n.user.id=new Uint8Array(n.user.id),navigator.credentials.create({publicKey:n}).then(function(n){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)));if(e.b64challenge!==a.challenge&&t(!1,"key returned something unexpected (1)"),"https://"+e.publicKey.rp.name!=a.origin)return t(!1,"key returned something unexpected (2)");if(!("type"in a))return t(!1,"key returned something unexpected (3)");if("webauthn.create"!=a.type)return t(!1,"key returned something unexpected (4)");var o=[];new Uint8Array(n.response.attestationObject).forEach(function(e){o.push(e)});var r=[];new Uint8Array(n.rawId).forEach(function(e){r.push(e)});var i={rawId:r,id:n.id,type:n.type,response:{attestationObject:o,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)))}};t(!0,JSON.stringify(i))}).catch(function(e){console.log(e),"name"in e?(console.log(e.name),"AbortError"==e.name||"NS_ERROR_ABORT"==e.name?t(!1,"abort"):t(!1,e.name)):t(!1,e.toString())})}(o,function(e,o){response.success?a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:o,_wpnonce:r},success:t}):t({success:!1,error:o})})},login:function(e,t){e.action;var n,a,r,i,u=e.payload;e._wpnonce,a=function(e,n){t({success:e,result:n})},r=(n=u).challenge,(i=Object.assign({},n)).challenge=new Uint8Array(n.challenge),i.allowCredentials=i.allowCredentials.map(function(e){var t=Object.assign({},e);return t.id=new Uint8Array(e.id),t}),navigator.credentials.get({publicKey:i}).then(function(e){var t=[];new Uint8Array(e.rawId).forEach(function(e){t.push(e)});var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON))),o=[];new Uint8Array(e.response.clientDataJSON).forEach(function(e){o.push(e)});var i=[];new Uint8Array(e.response.authenticatorData).forEach(function(e){i.push(e)});var u=[];new Uint8Array(e.response.signature).forEach(function(e){u.push(e)});var l={type:e.type,originalChallenge:r,rawId:t,response:{authenticatorData:i,clientData:n,clientDataJSONarray:o,signature:u}};a(!0,JSON.stringify(l))}).catch(function(e){console.log(e),"name"in e?(console.log(o(e)),console.log(e.name),console.log(e.message),"NotAllowedError"==e.name?a(!1,"not-allowed"):"AbortError"==e.name||"NS_ERROR_ABORT"==e.name?a(!1,"abort"):a(!1,e.toString())):a(!1,e.toString())})},sendRequest:function(e,t){var n=e.action,o=e.payload,r=e._wpnonce;a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:o,_wpnonce:r},success:t})},isWebauthnSupported:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},o=function(t,n){var o=n.action,r=n.payload,i=n._wpnonce,u=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!1),(0,a.default)(document).off("keydown"),(0,a.default)(t).off("blur"),n&&l!==u?((0,a.default)('<span class="spinner"></span>').insertAfter(t),(0,e.sendRequest)({action:o,payload:{md5id:r,label:u},_wpnonce:i},function(e){(0,a.default)(t).next(".spinner").remove()})):n||(0,a.default)(t).text(l)},l=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!0),(0,a.default)(document).on("keydown",function(e){13===e.which?(u(!0),e.preventDefault()):27===e.which&&u(!0)}),(0,a.default)(t).on("blur",function(e){return u(!0)}),(0,a.default)(t).focus(),document.execCommand("selectAll",!1,null)};(0,a.default)(document).on("click","#webauthn-register-key",function(t){t.preventDefault();var n=JSON.parse((0,a.default)(t.target).attr("data-create-options"));(0,e.register)(n,function(e){if(e.success){var t=(0,a.default)(e.html).appendTo("#webauthn-keys").find(".webauthn-label");o(t.get(0),JSON.parse(t.attr("data-action")))}else(0,a.default)('<span class="description">'.concat(e.info,"</span>")).insertAfter("#webauthn-register-key")})}),e.isWebauthnSupported?(0,a.default)(document).on("click",".webauthn-action",function(t){t.preventDefault();var n=(0,a.default)(t.target).closest(".webauthn-action"),r=JSON.parse(n.attr("data-action")),i=(0,a.default)(t.target).closest(".webauthn-key"),u=r.action,l=(r.payload,r._wpnonce);"webauthn-test-key"===r.action?(t.preventDefault(),(0,e.login)(r,function(t){console.log(t),t.success?(0,e.sendRequest)({action:u,payload:t.result,_wpnonce:l},function(e){e.success?n.find("[data-tested]").attr("data-tested","tested"):n.find("[data-tested]").attr("data-tested","fail")}):i.append('<div class="notice notice-inline notice-warning">Error: '.concat(t.result,"</div>"))})):"webauthn-delete-key"===r.action&&(t.preventDefault(),(0,e.sendRequest)(r,function(e){e.success&&i.remove()})),"webauthn-edit-key"===r.action&&"true"!==(0,a.default)(t.currentTarget).prop("contenteditable")&&(t.preventDefault(),o(t.currentTarget,r))}):((0,a.default)(".webauthn-unsupported").removeClass("hidden"),(0,a.default)(".webauthn-supported").addClass("hidden"))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2stZmxhdC9fcHJlbHVkZSIsInNyYy9qcy9saWIvZGF2aWRlYXJsLXdlYmF1dGhuLmpzIiwic3JjL2pzL2FkbWluL3R3by1mYWN0b3Itd2ViYXV0aG4vaW5kZXguanMiXSwibmFtZXMiOlsiXyRkYXZpZGVhcmxXZWJhdXRobl8yIiwib2JqIiwiX2pxdWVyeSIsIndpbmRvdyIsImpRdWVyeSIsImdsb2JhbCIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX3R5cGVvZiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJpc1dlYmF1dGhuU3VwcG9ydGVkIiwibmF2aWdhdG9yIiwicmVnaXN0ZXIiLCJvcHRzIiwiY2FsbGJhY2siLCJhY3Rpb24iLCJwYXlsb2FkIiwiX3dwbm9uY2UiLCJrZXkiLCJwdWJsaWNLZXkiLCJPYmplY3QiLCJhc3NpZ24iLCJhdHRlc3RhdGlvbiIsImNoYWxsZW5nZSIsIlVpbnQ4QXJyYXkiLCJ1c2VyIiwiaWQiLCJjcmVkZW50aWFscyIsImNyZWF0ZSIsInRoZW4iLCJhTmV3Q3JlZGVudGlhbEluZm8iLCJjZCIsIkpTT04iLCJwYXJzZSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImFwcGx5IiwicmVzcG9uc2UiLCJjbGllbnREYXRhSlNPTiIsImI2NGNoYWxsZW5nZSIsInJwIiwibmFtZSIsIm9yaWdpbiIsInR5cGUiLCJhbyIsImF0dGVzdGF0aW9uT2JqZWN0IiwiZm9yRWFjaCIsInYiLCJwdXNoIiwicmF3SWQiLCJpbmZvIiwic3RyaW5naWZ5IiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwidG9TdHJpbmciLCJzdWNjZXNzIiwiYWpheCIsInVybCIsIndwIiwic2V0dGluZ3MiLCJtZXRob2QiLCJkYXRhIiwiZXJyb3IiLCJsb2dpbiIsInB1YktleUF1dGgiLCJjYiIsIm9yaWdpbmFsQ2hhbGxlbmdlIiwicGsiLCJyZXN1bHQiLCJhbGxvd0NyZWRlbnRpYWxzIiwibWFwIiwiayIsInJldCIsImdldCIsImFBc3NlcnRpb24iLCJpZGEiLCJjZGEiLCJhZCIsImF1dGhlbnRpY2F0b3JEYXRhIiwic2lnIiwic2lnbmF0dXJlIiwiY2xpZW50RGF0YSIsImNsaWVudERhdGFKU09OYXJyYXkiLCJtZXNzYWdlIiwic2VuZFJlcXVlc3QiLCJlZGl0S2V5IiwiZWRpdExhYmVsIiwic3RvcEVkaXRpbmciLCJzYXZlIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwibmV3TGFiZWwiLCJ0ZXh0IiwicHJvcCIsImRvY3VtZW50Iiwib2ZmIiwicHJldkxhYmVsIiwiaW5zZXJ0QWZ0ZXIiLCJtZDVpZCIsImxhYmVsIiwibmV4dCIsInJlbW92ZSIsIm9uIiwiZSIsIndoaWNoIiwicHJldmVudERlZmF1bHQiLCJmb2N1cyIsImV4ZWNDb21tYW5kIiwidGFyZ2V0IiwiYXR0ciIsIiRrZXlMYWJlbCIsImh0bWwiLCJhcHBlbmRUbyIsImZpbmQiLCJjb25jYXQiLCIkYnRuIiwiY2xvc2VzdCIsIiRrZXlFbCIsImFwcGVuZCIsImN1cnJlbnRUYXJnZXQiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBLElBQUFBLEVBQUEsNkJDREEsSUFBQUMsRUFBQUMsR0FBQUQsRUFBQSxvQkFBQUUsT0FBQUEsT0FBQUMsWUFBQSxJQUFBQyxFQUFBQSxFQUFBRCxPQUFBLE9BQUFILEVBQUFLLFdBQUFMLEVBQUEsQ0FBQU0sUUFBQU4sR0FBQSxTQUFBTyxFQUFBUCxHQUFBLE9BQUFPLEVBQUEsbUJBQUFDLFFBQUEsaUJBQUFBLE9BQUFDLFNBQUEsU0FBQVQsR0FBQSxjQUFBQSxHQUFBLFNBQUFBLEdBQUEsT0FBQUEsR0FBQSxtQkFBQVEsUUFBQVIsRUFBQVUsY0FBQUYsUUFBQVIsSUFBQVEsT0FBQUcsVUFBQSxnQkFBQVgsSUFBQUEsR0EySkEsSUFrRE1ZLEVBQXNCLGdCQUFpQkMsVUFFN0NkLEVBQWlCLENBQ2hCZSxTQW5EZ0IsU0FBRUMsRUFBTUMsR0FB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USxRQUFRLGlCQUMzQnZHLEVBQThCRixFQUE5QkUsT0FBaUJFLEdBQWFKLEVBQXRCRyxRQUFzQkgsRUFBYkksVUFFSixzQkFBaEJKLEVBQUtFLFFBQ1QwRixFQUFFRSxrQkFBQSxFQUNGOUcsRUFBQW9FLE9BQU9wRCxFQUFNLFNBQUF5RCxHQUVaaEIsUUFBUUMsSUFBSWUsR0FDTEEsRUFBT2IsU0FBQSxFQUlkNUQsRUFBQXlGLGFBQWEsQ0FBRXZFLE9BQUFBLEVBQVFDLFFBQVNzRCxFQUFPQSxPQUFRckQsU0FBQUEsR0FBWSxTQUFBb0IsR0FDckRBLEVBQVNvQixRQUNiNEQsRUFBS0YsS0FBSyxpQkFBaUJKLEtBQUssY0FBYyxVQUU5Q00sRUFBS0YsS0FBSyxpQkFBaUJKLEtBQUssY0FBYyxVQVAvQ1EsRUFBT0MsT0FBUCwyREFBQUosT0FBeUU5QyxFQUFPQSxPQUFoRixjQVd5Qix3QkFBaEJ6RCxFQUFLRSxTQUNoQjBGLEVBQUVFLGtCQUFBLEVBQ0Y5RyxFQUFBeUYsYUFBYXpFLEVBQU0sU0FBVXdCLEdBRXZCQSxFQUFTb0IsU0FFYjhELEVBQU9oQixZQUdhLHNCQUFoQjFGLEVBQUtFLFFBQ04sVUFBQSxFQUFXaEIsRUFBQUssU0FBRXFHLEVBQUVnQixlQUFlMUIsS0FBTSxxQkFDeENVLEVBQUVFLGlCQUNGcEIsRUFBU2tCLEVBQUVnQixjQUFlNUcsUUFBQSxFQUs3QmQsRUFBQUssU0FBRSx5QkFBeUJzSCxZQUFZLFdBQUEsRUFDdkMzSCxFQUFBSyxTQUFFLHVCQUF1QnVILFNBQVMsNEhGM0huQyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xuIiwiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuXG4vKipcbiAqXHRTdG9sZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRlYXJsL3dlYmF1dGhuXG4gKi9cbmZ1bmN0aW9uIHdlYmF1dGhuQXV0aGVudGljYXRlKCBwdWJLZXlBdXRoLCBjYiApIHtcblxuXHRjb25zdCBvcmlnaW5hbENoYWxsZW5nZSA9IHB1YktleUF1dGguY2hhbGxlbmdlO1xuXHRjb25zdCBwayA9IE9iamVjdC5hc3NpZ24oIHt9LCBwdWJLZXlBdXRoIClcblxuXHRway5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheSggcHViS2V5QXV0aC5jaGFsbGVuZ2UgKVxuXHRway5hbGxvd0NyZWRlbnRpYWxzID0gcGsuYWxsb3dDcmVkZW50aWFscy5tYXAoIGsgPT4ge1xuXHRcdGxldCByZXQgPSBPYmplY3QuYXNzaWduKCB7fSwgayApXG5cdFx0cmV0LmlkID0gbmV3IFVpbnQ4QXJyYXkoay5pZCk7XG5cdFx0cmV0dXJuIHJldFxuXHR9IClcblxuXHQvKiBhc2sgdGhlIGJyb3dzZXIgdG8gcHJvbXB0IHRoZSB1c2VyICovXG5cdG5hdmlnYXRvci5jcmVkZW50aWFscy5nZXQoIHsgcHVibGljS2V5OiBwayB9IClcblx0XHQudGhlbiggYUFzc2VydGlvbiA9PiB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkNyZWRlbnRpYWxzLkdldCByZXNwb25zZTogXCIsIGFBc3NlcnRpb24pO1xuXHRcdFx0dmFyIGlkYSA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmF3SWQpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpeyBpZGEucHVzaCh2KTsgfSk7XG5cdFx0XHR2YXIgY2QgPSBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2UuY2xpZW50RGF0YUpTT04pKSk7XG5cdFx0XHR2YXIgY2RhID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpLmZvckVhY2goZnVuY3Rpb24odil7IGNkYS5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBhZCA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2UuYXV0aGVudGljYXRvckRhdGEpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpeyBhZC5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBzaWcgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhQXNzZXJ0aW9uLnJlc3BvbnNlLnNpZ25hdHVyZSkpLmZvckVhY2goZnVuY3Rpb24odil7IHNpZy5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBpbmZvID0ge1xuXHRcdFx0XHR0eXBlOiBhQXNzZXJ0aW9uLnR5cGUsXG5cdFx0XHRcdG9yaWdpbmFsQ2hhbGxlbmdlOiBvcmlnaW5hbENoYWxsZW5nZSxcblx0XHRcdFx0cmF3SWQ6IGlkYSxcblx0XHRcdFx0cmVzcG9uc2U6IHtcblx0XHRcdFx0XHRhdXRoZW50aWNhdG9yRGF0YTogYWQsXG5cdFx0XHRcdFx0Y2xpZW50RGF0YTogY2QsXG5cdFx0XHRcdFx0Y2xpZW50RGF0YUpTT05hcnJheTogY2RhLFxuXHRcdFx0XHRcdHNpZ25hdHVyZTogc2lnXG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHRjYiggdHJ1ZSwgSlNPTi5zdHJpbmdpZnkoIGluZm8gKSApO1xuXHRcdH0pXG5cdFx0LmNhdGNoKCBlcnIgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coZXJyKVxuXHRcdFx0Lypcblx0XHRcdEZGIG1hYzpcblx0XHRcdEludmFsaWRTdGF0ZUVycm9yOiBrZXkgbm90IGZvdW5kXG5cdFx0XHRBYm9ydEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6ID9cblx0XHRcdFx0VGhlIHJlcXVlc3QgaXMgbm90IGFsbG93ZWQgYnkgdGhlIHVzZXIgYWdlbnQgb3IgdGhlIHBsYXRmb3JtIGluIHRoZSBjdXJyZW50IGNvbnRleHQsIHBvc3NpYmx5IGJlY2F1c2UgdGhlIHVzZXIgZGVuaWVkIHBlcm1pc3Npb24uXG5cblx0XHRcdENocm9tZSBtYWM6XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblxuXHRcdFx0U2FmYXJpIG1hYzpcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRFZGdlIHdpbjEwOlxuXHRcdFx0VW5rbm93bkVycm9yOiB3cm9uZyBrZXkuLi4/XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblxuXHRcdFx0RkYgd2luOlxuXHRcdFx0Tm90QWxsb3dlZEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cdFx0XHRcdERPTUV4Y2VwdGlvbjogXCJUaGUgcmVxdWVzdCBpcyBub3QgYWxsb3dlZCBieSB0aGUgdXNlciBhZ2VudCBvciB0aGUgcGxhdGZvcm0gaW4gdGhlIGN1cnJlbnQgY29udGV4dCwgcG9zc2libHkgYmVjYXVzZSB0aGUgdXNlciBkZW5pZWQgcGVybWlzc2lvbi5cIlxuXG5cdFx0XHQqL1xuXHRcdFx0aWYgKCBcIm5hbWVcIiBpbiBlcnIgKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKHR5cGVvZiBlcnIpXG5cdFx0XHRcdGNvbnNvbGUubG9nKGVyci5uYW1lKVxuXHRcdFx0XHRjb25zb2xlLmxvZyhlcnIubWVzc2FnZSlcblx0XHRcdFx0Ly8gY2hhbmdlOiBkaXN0aWd1aXNoIGJldHdlZW4gZXJyb3JzXG5cdFx0XHRcdGlmICggZXJyLm5hbWUgPT0gXCJOb3RBbGxvd2VkRXJyb3JcIiApIHtcblx0XHRcdFx0XHRjYiggZmFsc2UsICdub3QtYWxsb3dlZCcgKTtcblx0XHRcdFx0fSBlbHNlIGlmICggZXJyLm5hbWUgPT0gXCJBYm9ydEVycm9yXCIgfHwgZXJyLm5hbWUgPT0gXCJOU19FUlJPUl9BQk9SVFwiICkge1xuXHRcdFx0XHRcdGNiKCBmYWxzZSwgJ2Fib3J0JyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNiKCBmYWxzZSwgZXJyLnRvU3RyaW5nKCkgKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2IoIGZhbHNlLCBlcnIudG9TdHJpbmcoKSApO1xuXHRcdFx0fVxuXHRcdH0pO1xufVxuXG4vKipcbiAqXHRTdG9sZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRlYXJsL3dlYmF1dGhuXG4gKi9cbmZ1bmN0aW9uIHdlYmF1dGhuUmVnaXN0ZXIoIGtleSwgY2FsbGJhY2sgKXtcblxuXHRsZXQgcHVibGljS2V5ID0gT2JqZWN0LmFzc2lnbigge30sIGtleS5wdWJsaWNLZXkgKTtcblxuXHRwdWJsaWNLZXkuYXR0ZXN0YXRpb24gPSB1bmRlZmluZWQ7XG5cdHB1YmxpY0tleS5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LmNoYWxsZW5nZSApOyAvLyBjb252ZXJ0IHR5cGUgZm9yIHVzZSBieSBrZXlcblx0cHVibGljS2V5LnVzZXIuaWQgPSBuZXcgVWludDhBcnJheSggcHVibGljS2V5LnVzZXIuaWQgKTtcblxuXHQvLyBjb25zb2xlLmxvZyhrZXkpO1xuXHRuYXZpZ2F0b3IuY3JlZGVudGlhbHMuY3JlYXRlKCB7IHB1YmxpY0tleSB9IClcblx0XHQudGhlbihmdW5jdGlvbiAoYU5ld0NyZWRlbnRpYWxJbmZvKSB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkNyZWRlbnRpYWxzLkNyZWF0ZSByZXNwb25zZTogXCIsIGFOZXdDcmVkZW50aWFsSW5mbyk7XG5cdFx0XHR2YXIgY2QgPSBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYU5ld0NyZWRlbnRpYWxJbmZvLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkpO1xuXHRcdFx0aWYgKCBrZXkuYjY0Y2hhbGxlbmdlICE9PSBjZC5jaGFsbGVuZ2UgKSB7XG5cdFx0XHRcdGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgxKScpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCdodHRwczovLycra2V5LnB1YmxpY0tleS5ycC5uYW1lICE9IGNkLm9yaWdpbikge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDIpJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoISAoJ3R5cGUnIGluIGNkKSkge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDMpJyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoY2QudHlwZSAhPSAnd2ViYXV0aG4uY3JlYXRlJykge1xuXHRcdFx0XHRyZXR1cm4gY2FsbGJhY2soZmFsc2UsICdrZXkgcmV0dXJuZWQgc29tZXRoaW5nIHVuZXhwZWN0ZWQgKDQpJyk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBhbyA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yZXNwb25zZS5hdHRlc3RhdGlvbk9iamVjdCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdGFvLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciByYXdJZCA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yYXdJZCkpLmZvckVhY2goZnVuY3Rpb24odil7XG5cdFx0XHRcdHJhd0lkLnB1c2godik7XG5cdFx0XHR9KTtcblx0XHRcdHZhciBpbmZvID0ge1xuXHRcdFx0XHRyYXdJZDogcmF3SWQsXG5cdFx0XHRcdGlkOiBhTmV3Q3JlZGVudGlhbEluZm8uaWQsXG5cdFx0XHRcdHR5cGU6IGFOZXdDcmVkZW50aWFsSW5mby50eXBlLFxuXHRcdFx0XHRyZXNwb25zZToge1xuXHRcdFx0XHRcdGF0dGVzdGF0aW9uT2JqZWN0OiBhbyxcblx0XHRcdFx0XHRjbGllbnREYXRhSlNPTjpcblx0XHRcdFx0XHQgIEpTT04ucGFyc2UoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmVzcG9uc2UuY2xpZW50RGF0YUpTT04pKSlcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdGNhbGxiYWNrKHRydWUsIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcblx0XHR9KVxuXHRcdC5jYXRjaCggZXJyID0+IHtcblx0XHRcdGNvbnNvbGUubG9nKGVycilcblxuXHRcdFx0aWYgKCBcIm5hbWVcIiBpbiBlcnIgKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGVyci5uYW1lKVxuXHRcdFx0XHRpZiAoZXJyLm5hbWUgPT0gXCJBYm9ydEVycm9yXCIgfHwgZXJyLm5hbWUgPT0gXCJOU19FUlJPUl9BQk9SVFwiKSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCAnYWJvcnQnICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIubmFtZSApO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjYWxsYmFjayggZmFsc2UsIGVyci50b1N0cmluZygpICk7XG5cdFx0XHR9XG5cdFx0fSk7XG59XG5cbi8qKlxuICpcdEBwYXJhbSBBcnJheUJ1ZmZlciBhcnJheUJ1ZlxuICpcdEByZXR1cm4gQXJyYXlcbiAqL1xuY29uc3QgYnVmZmVyMkFycmF5ID0gYXJyYXlCdWYgPT4gWyAuLi4gKG5ldyBVaW50OEFycmF5KCBhcnJheUJ1ZiApKSBdO1xuXG5jb25zdCByZWdpc3RlciA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuUmVnaXN0ZXIoIHBheWxvYWQsIChzdWNjZXNzLGluZm8pID0+IHtcblx0XHRpZiAoIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6IHdwLmFqYXguc2V0dGluZ3MudXJsLFxuXHRcdFx0XHRtZXRob2Q6ICdwb3N0Jyxcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogYWN0aW9uLFxuXHRcdFx0XHRcdHBheWxvYWQ6IGluZm8sXG5cdFx0XHRcdFx0X3dwbm9uY2U6IF93cG5vbmNlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN1Y2Nlc3M6IGNhbGxiYWNrXG5cdFx0XHR9KVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYWxsYmFjayggeyBzdWNjZXNzOmZhbHNlLCBlcnJvcjppbmZvIH0gKVxuXHRcdH1cblx0fSlcbn1cblxuXG5jb25zdCBsb2dpbiA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuQXV0aGVudGljYXRlKCBwYXlsb2FkLCAoIHN1Y2Nlc3MsIGluZm8gKSA9PiB7XG5cdFx0Y2FsbGJhY2soIHsgc3VjY2VzcywgcmVzdWx0OiBpbmZvIH0gKVxuXHR9KVxufVxuXG5jb25zdCBzZW5kUmVxdWVzdCA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdCQuYWpheCh7XG5cdFx0dXJsOiB3cC5hamF4LnNldHRpbmdzLnVybCxcblx0XHRtZXRob2Q6ICdwb3N0Jyxcblx0XHRkYXRhOiB7XG5cdFx0XHRhY3Rpb246IGFjdGlvbixcblx0XHRcdHBheWxvYWQ6IHBheWxvYWQsXG5cdFx0XHRfd3Bub25jZTogX3dwbm9uY2Vcblx0XHR9LFxuXHRcdHN1Y2Nlc3M6Y2FsbGJhY2tcblx0fSlcbn1cblxuY29uc3QgaXNXZWJhdXRoblN1cHBvcnRlZCA9ICdjcmVkZW50aWFscycgaW4gbmF2aWdhdG9yXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXHRyZWdpc3Rlcixcblx0bG9naW4sXG5cdHNlbmRSZXF1ZXN0LFxuXHRpc1dlYmF1dGhuU3VwcG9ydGVkXG59XG4iLCJpbXBvcnQgJCBmcm9tICdqcXVlcnknXG5pbXBvcnQgeyByZWdpc3RlciwgbG9naW4sIHNlbmRSZXF1ZXN0LCBpc1dlYmF1dGhuU3VwcG9ydGVkIH0gZnJvbSAnZGF2aWRlYXJsLXdlYmF1dGhuJ1xuXG5cblxuY29uc3QgZWRpdEtleSA9ICggZWRpdExhYmVsLCBvcHRzICkgPT4ge1xuXG5cdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0c1xuXG5cblx0Ly8gY29uc29sZS5sb2coJGVkaXRMYWJlbC5wcm9wKCAnY29udGVudGVkaXRhYmxlJyApKTtcblx0Y29uc3Qgc3RvcEVkaXRpbmcgPSAoIHNhdmUgPSBmYWxzZSApID0+IHtcblx0XHRsZXQgbmV3TGFiZWwgPSAkKGVkaXRMYWJlbCkudGV4dCgpXG5cdFx0JChlZGl0TGFiZWwpLnByb3AoICdjb250ZW50ZWRpdGFibGUnLCBmYWxzZSApO1xuXHRcdCQoZG9jdW1lbnQpLm9mZiggJ2tleWRvd24nIClcblx0XHQkKGVkaXRMYWJlbCkub2ZmKCAnYmx1cicgKVxuXHRcdGlmICggc2F2ZSAmJiBwcmV2TGFiZWwgIT09IG5ld0xhYmVsICkge1xuXG5cdFx0XHQkKCc8c3BhbiBjbGFzcz1cInNwaW5uZXJcIj48L3NwYW4+JykuaW5zZXJ0QWZ0ZXIoZWRpdExhYmVsKVxuXG5cdFx0XHRzZW5kUmVxdWVzdChcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGFjdGlvbixcblx0XHRcdFx0XHRwYXlsb2FkOiB7IG1kNWlkOiBwYXlsb2FkLCBsYWJlbDogbmV3TGFiZWwgfSxcblx0XHRcdFx0XHRfd3Bub25jZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0JChlZGl0TGFiZWwpLm5leHQoJy5zcGlubmVyJykucmVtb3ZlKClcblx0XHRcdFx0fVxuXHRcdFx0KTtcblx0XHR9IGVsc2UgaWYgKCAhIHNhdmUgKSB7XG5cdFx0XHQkKGVkaXRMYWJlbCkudGV4dChwcmV2TGFiZWwpXG5cdFx0fVxuXHR9XG5cblx0Y29uc3QgcHJldkxhYmVsID0gJChlZGl0TGFiZWwpLnRleHQoKVxuXG5cdCQoZWRpdExhYmVsKS5wcm9wKCAnY29udGVudGVkaXRhYmxlJywgdHJ1ZSApO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCAna2V5ZG93bicsIGUgPT4ge1xuXHRcdGlmICggZS53aGljaCA9PT0gMTMgKSB7XG5cdFx0XHRzdG9wRWRpdGluZyggdHJ1ZSApXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHR9IGVsc2UgaWYgKCBlLndoaWNoID09PSAyNyApIHtcblx0XHRcdHN0b3BFZGl0aW5nKCB0cnVlIClcblx0XHR9XG5cdH0gKVxuXG5cdC8vIGZvY3VzIGFuZCBzZWxlY3Rcblx0JChlZGl0TGFiZWwpLm9uKCAnYmx1cicsIGUgPT4gc3RvcEVkaXRpbmcoIHRydWUgKSApXG5cblx0JChlZGl0TGFiZWwpLmZvY3VzKClcblxuXHRkb2N1bWVudC5leGVjQ29tbWFuZCggJ3NlbGVjdEFsbCcsIGZhbHNlLCBudWxsICk7XG5cbn1cblxuJChkb2N1bWVudCkub24oICdjbGljaycsICcjd2ViYXV0aG4tcmVnaXN0ZXIta2V5JywgZSA9PiB7XG5cblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdGNvbnN0IG9wdHMgPSBKU09OLnBhcnNlKCAkKGUudGFyZ2V0KS5hdHRyKCdkYXRhLWNyZWF0ZS1vcHRpb25zJykgKTtcblxuXHRyZWdpc3Rlciggb3B0cywgcmVzcG9uc2UgPT4ge1xuXG5cdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0bGV0ICRrZXlJdGVtID0gJChyZXNwb25zZS5odG1sKS5hcHBlbmRUbygnI3dlYmF1dGhuLWtleXMnKVxuXHRcdFx0bGV0ICRrZXlMYWJlbCA9ICRrZXlJdGVtLmZpbmQoJy53ZWJhdXRobi1sYWJlbCcpXG5cblx0XHRcdGVkaXRLZXkoXG5cdFx0XHRcdCRrZXlMYWJlbC5nZXQoMCksXG5cdFx0XHRcdEpTT04ucGFyc2UoICRrZXlMYWJlbC5hdHRyKCdkYXRhLWFjdGlvbicpIClcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoYDxzcGFuIGNsYXNzPVwiZGVzY3JpcHRpb25cIj4ke3Jlc3BvbnNlLmluZm99PC9zcGFuPmApLmluc2VydEFmdGVyKCcjd2ViYXV0aG4tcmVnaXN0ZXIta2V5Jylcblx0XHR9XG5cdH0pO1xuXG59KTtcblxuaWYgKCBpc1dlYmF1dGhuU3VwcG9ydGVkICkge1xuXHQkKGRvY3VtZW50KS5vbignY2xpY2snLCcud2ViYXV0aG4tYWN0aW9uJywgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGNvbnN0ICRidG4gPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcud2ViYXV0aG4tYWN0aW9uJyk7XG5cdFx0Y29uc3Qgb3B0cyA9IEpTT04ucGFyc2UoICRidG4uYXR0cignZGF0YS1hY3Rpb24nKSApO1xuXHRcdGNvbnN0ICRrZXlFbCA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJy53ZWJhdXRobi1rZXknKVxuXHRcdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0c1xuXG5cdFx0aWYgKCBvcHRzLmFjdGlvbiA9PT0gJ3dlYmF1dGhuLXRlc3Qta2V5JyApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGxvZ2luKCBvcHRzLCByZXN1bHQgPT4ge1xuXHRcdFx0XHQvLyBzZW5kIHRoYXQgY3JhcCB0byBzZXJ2ZXJcblx0XHRcdFx0Y29uc29sZS5sb2cocmVzdWx0KVxuXHRcdFx0XHRpZiAoICEgcmVzdWx0LnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdFx0JGtleUVsLmFwcGVuZChgPGRpdiBjbGFzcz1cIm5vdGljZSBub3RpY2UtaW5saW5lIG5vdGljZS13YXJuaW5nXCI+RXJyb3I6ICR7cmVzdWx0LnJlc3VsdH08L2Rpdj5gKVxuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRzZW5kUmVxdWVzdCggeyBhY3Rpb24sIHBheWxvYWQ6IHJlc3VsdC5yZXN1bHQsIF93cG5vbmNlIH0sIHJlc3BvbnNlID0+IHtcblx0XHRcdFx0XHRpZiAoIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdFx0XHQkYnRuLmZpbmQoJ1tkYXRhLXRlc3RlZF0nKS5hdHRyKCdkYXRhLXRlc3RlZCcsJ3Rlc3RlZCcpXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdCRidG4uZmluZCgnW2RhdGEtdGVzdGVkXScpLmF0dHIoJ2RhdGEtdGVzdGVkJywnZmFpbCcpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KVxuXHRcdFx0fSApO1xuXHRcdH0gZWxzZSBpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tZGVsZXRlLWtleScgKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRzZW5kUmVxdWVzdCggb3B0cywgZnVuY3Rpb24oIHJlc3BvbnNlICkge1xuXHRcdFx0XHQvLyByZW1vdmVcblx0XHRcdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXG5cdFx0XHRcdFx0JGtleUVsLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9ICk7XG5cdFx0fSBpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tZWRpdC1rZXknICkge1xuXHRcdFx0aWYgKCAndHJ1ZScgIT09ICQoZS5jdXJyZW50VGFyZ2V0KS5wcm9wKCAnY29udGVudGVkaXRhYmxlJyApICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGVkaXRLZXkoIGUuY3VycmVudFRhcmdldCwgb3B0cyApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59IGVsc2Uge1xuXHQkKCcud2ViYXV0aG4tdW5zdXBwb3J0ZWQnKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG5cdCQoJy53ZWJhdXRobi1zdXBwb3J0ZWQnKS5hZGRDbGFzcygnaGlkZGVuJyk7XG59XG4iXX0=