!function(){var e={};(function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r="credentials"in navigator;e={register:function(e,t){var n=e.action,r=e.payload,o=e._wpnonce;!function(e,t){var n=Object.assign({},e.publicKey);n.attestation=void 0,n.challenge=new Uint8Array(n.challenge),n.user.id=new Uint8Array(n.user.id),navigator.credentials.create({publicKey:n}).then(function(n){var a=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)));if(e.b64challenge!==a.challenge&&t(!1,"key returned something unexpected (1)"),!("type"in a))return t(!1,"key returned something unexpected (3)");if("webauthn.create"!=a.type)return t(!1,"key returned something unexpected (4)");var r=[];new Uint8Array(n.response.attestationObject).forEach(function(e){r.push(e)});var o=[];new Uint8Array(n.rawId).forEach(function(e){o.push(e)});var i={rawId:o,id:n.id,type:n.type,response:{attestationObject:r,clientDataJSON:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n.response.clientDataJSON)))}};t(!0,JSON.stringify(i))}).catch(function(e){t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(r,function(e,r){e?a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:r,_wpnonce:o},success:t}):t({success:!1,message:r})})},login:function(e,t){e.action;var n=e.payload;e._wpnonce,function(e,t){var n=e.challenge,a=Object.assign({},e);a.challenge=new Uint8Array(e.challenge),a.allowCredentials=a.allowCredentials.map(function(e){var t=Object.assign({},e);return t.id=new Uint8Array(e.id),t}),navigator.credentials.get({publicKey:a}).then(function(e){var a=[];new Uint8Array(e.rawId).forEach(function(e){a.push(e)});var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON))),o=[];new Uint8Array(e.response.clientDataJSON).forEach(function(e){o.push(e)});var i=[];new Uint8Array(e.response.authenticatorData).forEach(function(e){i.push(e)});var s=[];new Uint8Array(e.response.signature).forEach(function(e){s.push(e)});var u={type:e.type,originalChallenge:n,rawId:a,response:{authenticatorData:i,clientData:r,clientDataJSONarray:o,signature:s}};t(!0,JSON.stringify(u))}).catch(function(e){console.log(e),t(!1,"name"in e?e.name+": "+e.message:e.toString())})}(n,function(e,n){t(e?{success:!0,result:n}:{success:!1,message:n})})},sendRequest:function(e,t){var n=e.action,r=e.payload,o=e._wpnonce;a.default.ajax({url:wp.ajax.settings.url,method:"post",data:{action:n,payload:r,_wpnonce:o},success:t})},isWebauthnSupported:r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){"use strict";var n,a=(n="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&n.__esModule?n:{default:n},r=function(t,n){var r=n.action,o=n.payload,i=n._wpnonce,s=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=(0,a.default)(t).text();(0,a.default)(t).text(s),(0,a.default)(t).prop("contenteditable",!1),(0,a.default)(document).off("keydown"),(0,a.default)(t).off("blur"),n&&u!==s?((0,a.default)(t).addClass("busy"),(0,e.sendRequest)({action:r,payload:{md5id:o,label:s},_wpnonce:i},function(e){(0,a.default)(t).removeClass("busy")})):n||(0,a.default)(t).text(u)},u=(0,a.default)(t).text();(0,a.default)(t).prop("contenteditable",!0),(0,a.default)(document).on("keydown",function(e){13===e.which?(s(!0),e.preventDefault()):27===e.which&&s(!0)}),(0,a.default)(t).on("blur",function(e){return s(!0)}).on("paste",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}),(0,a.default)(t).focus(),document.execCommand("selectAll",!1,null)};(0,a.default)(document).on("click","#webauthn-register-key",function(t){t.preventDefault(),(0,a.default)(t.target).next(".webauthn-error").remove();var n=(0,a.default)(t.target).addClass("busy"),o=JSON.parse((0,a.default)(t.target).attr("data-create-options"));(0,e.register)(o,function(e){if(n.removeClass("busy"),e.success){var t=(0,a.default)(e.html).appendTo("#webauthn-keys").find(".webauthn-label");r(t.get(0),JSON.parse(t.attr("data-action")))}else(0,a.default)('<span class="webauthn-error description">'.concat(e.message,"</span>")).insertAfter("#webauthn-register-key")})}),e.isWebauthnSupported?(0,a.default)(document).on("click",".webauthn-action",function(t){t.preventDefault();var n=(0,a.default)(t.target).closest(".webauthn-action"),o=JSON.parse(n.attr("data-action")),i=(0,a.default)(t.target).closest(".webauthn-key"),s=o.action,u=(o.payload,o._wpnonce);"webauthn-test-key"===o.action?(t.preventDefault(),i.find(".notice").remove(),n.addClass("busy"),(0,e.login)(o,function(t){if(!t.success)return i.append('<div class="notice notice-inline notice-warning">'.concat(t.message,"</div>")),void n.removeClass("busy");(0,e.sendRequest)({action:s,payload:t.result,_wpnonce:u},function(e){e.success?n.find("[data-tested]").attr("data-tested","tested"):(n.find("[data-tested]").attr("data-tested","fail"),i.append('<div class="notice notice-inline notice-error">'.concat(e.message,"</div>"))),n.removeClass("busy")})})):"webauthn-delete-key"===o.action&&(i.addClass("busy"),t.preventDefault(),(0,e.sendRequest)(o,function(e){e.success&&i.remove()})),"webauthn-edit-key"===o.action&&"true"!==(0,a.default)(t.currentTarget).prop("contenteditable")&&(t.preventDefault(),r(t.currentTarget,o))}):((0,a.default)(".webauthn-unsupported").removeClass("hidden"),(0,a.default)(".webauthn-supported").addClass("hidden"))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2stZmxhdC9fcHJlbHVkZSIsInNyYy9qcy9saWIvZGF2aWRlYXJsLXdlYmF1dGhuLmpzIiwic3JjL2pzL2FkbWluL3R3by1mYWN0b3Itd2ViYXV0aG4vaW5kZXguanMiXSwibmFtZXMiOlsiXyRkYXZpZGVhcmxXZWJhdXRobl8yIiwib2JqIiwiX2pxdWVyeSIsIndpbmRvdyIsImpRdWVyeSIsImdsb2JhbCIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiaXNXZWJhdXRoblN1cHBvcnRlZCIsIm5hdmlnYXRvciIsInJlZ2lzdGVyIiwib3B0cyIsImNhbGxiYWNrIiwiYWN0aW9uIiwicGF5bG9hZCIsIl93cG5vbmNlIiwia2V5IiwicHVibGljS2V5IiwiT2JqZWN0IiwiYXNzaWduIiwiYXR0ZXN0YXRpb24iLCJjaGFsbGVuZ2UiLCJVaW50OEFycmF5IiwidXNlciIsImlkIiwiY3JlZGVudGlhbHMiLCJjcmVhdGUiLCJ0aGVuIiwiYU5ld0NyZWRlbnRpYWxJbmZvIiwiY2QiLCJKU09OIiwicGFyc2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsInJlc3BvbnNlIiwiY2xpZW50RGF0YUpTT04iLCJiNjRjaGFsbGVuZ2UiLCJ0eXBlIiwiYW8iLCJhdHRlc3RhdGlvbk9iamVjdCIsImZvckVhY2giLCJ2IiwicHVzaCIsInJhd0lkIiwiaW5mbyIsInN0cmluZ2lmeSIsImNhdGNoIiwiZXJyIiwibmFtZSIsIm1lc3NhZ2UiLCJ0b1N0cmluZyIsInN1Y2Nlc3MiLCJhamF4IiwidXJsIiwid3AiLCJzZXR0aW5ncyIsIm1ldGhvZCIsImRhdGEiLCJsb2dpbiIsInB1YktleUF1dGgiLCJvcmlnaW5hbENoYWxsZW5nZSIsInBrIiwiYWxsb3dDcmVkZW50aWFscyIsIm1hcCIsImsiLCJyZXQiLCJnZXQiLCJhQXNzZXJ0aW9uIiwiaWRhIiwiY2RhIiwiYWQiLCJhdXRoZW50aWNhdG9yRGF0YSIsInNpZyIsInNpZ25hdHVyZSIsImNsaWVudERhdGEiLCJjbGllbnREYXRhSlNPTmFycmF5IiwiY29uc29sZSIsImxvZyIsInJlc3VsdCIsInNlbmRSZXF1ZXN0IiwiZWRpdEtleSIsImVkaXRMYWJlbCIsInN0b3BFZGl0aW5nIiwic2F2ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsIm5ld0xhYmVsIiwidGV4dCIsInByb3AiLCJkb2N1bWVudCIsIm9mZiIsInByZXZMYWJlbCIsImFkZENsYXNzIiwibWQ1aWQiLCJsYWJlbCIsInJlbW92ZUNsYXNzIiwib24iLCJlIiwid2hpY2giLCJwcmV2ZW50RGVmYXVsdCIsIm9yaWdpbmFsRXZlbnQiLCJjbGlwYm9hcmREYXRhIiwiZ2V0RGF0YSIsImV4ZWNDb21tYW5kIiwiZm9jdXMiLCJ0YXJnZXQiLCJuZXh0IiwicmVtb3ZlIiwiJGJ0biIsImF0dHIiLCIka2V5TGFiZWwiLCJodG1sIiwiYXBwZW5kVG8iLCJmaW5kIiwiY29uY2F0IiwiaW5zZXJ0QWZ0ZXIiLCJjbG9zZXN0IiwiJGtleUVsIiwiYXBwZW5kIiwiY3VycmVudFRhcmdldCJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxJQUFBQSxFQUFBLDZCQ0RBLElBQUFDLEVBQUFDLEdBQUFELEVBQUEsb0JBQUFFLE9BQUFBLE9BQUFDLFlBQUEsSUFBQUMsRUFBQUEsRUFBQUQsT0FBQSxPQUFBSCxFQUFBSyxXQUFBTCxFQUFBLENBQUFNLFFBQUFOLEdBb01NTyxFQUFzQixnQkFBaUJDLFVBRTdDVCxFQUFpQixDQUNoQlUsU0F4RGdCLFNBQUVDLEVBQU1DLEdBQWMsSUFFOUJDLEVBQThCRixFQUE5QkUsT0FBUUMsRUFBc0JILEVBQXRCRyxRQUFTQyxFQUFhSixFQUFiSSxVQS9EMUIsU0FBMkJDLEVBQUtKLEdBRS9CLElBQUlLLEVBQVlDLE9BQU9DLE9BQVEsR0FBSUgsRUFBSUMsV0FFdkNBLEVBQVVHLGlCQUFBLEVBQ1ZILEVBQVVJLFVBQVksSUFBSUMsV0FBWUwsRUFBVUksV0FDaERKLEVBQVVNLEtBQUtDLEdBQUssSUFBSUYsV0FBWUwsRUFBVU0sS0FBS0MsSUFHbkRmLFVBQVVnQixZQUFZQyxPQUFRLENBQUVULFVBQUFBLElBQzlCVSxLQUFLLFNBQVVDLEdBRWYsSUFBSUMsRUFBS0MsS0FBS0MsTUFBTUMsT0FBT0MsYUFBYUMsTUFBTSxLQUFNLElBQUlaLFdBQVdNLEVBQW1CTyxTQUFTQyxrQkFPL0YsR0FOS3BCLEVBQUlxQixlQUFpQlIsRUFBR1IsV0FDNUJULEdBQUEsRUFBZ0IsMkNBS1YsU0FBVWlCLEdBQ2hCLE9BQU9qQixHQUFBLEVBQWdCLHlDQUV4QixHQUFlLG1CQUFYaUIsRUFBR1MsS0FDTixPQUFPMUIsR0FBQSxFQUFnQix5Q0FHeEIsSUFBSTJCLEVBQUssR0FDUixJQUFJakIsV0FBV00sRUFBbUJPLFNBQVNLLG1CQUFvQkMsUUFBUSxTQUFTQyxHQUNoRkgsRUFBR0ksS0FBS0QsS0FFVCxJQUFJRSxFQUFRLEdBQ1gsSUFBSXRCLFdBQVdNLEVBQW1CZ0IsT0FBUUgsUUFBUSxTQUFTQyxHQUMzREUsRUFBTUQsS0FBS0QsS0FFWixJQUFJRyxFQUFPLENBQ1ZELE1BQU9BLEVBQ1BwQixHQUFJSSxFQUFtQkosR0FDdkJjLEtBQU1WLEVBQW1CVSxLQUN6QkgsU0FBVSxDQUNUSyxrQkFBbUJELEVBQ25CSCxlQUNFTixLQUFLQyxNQUFNQyxPQUFPQyxhQUFhQyxNQUFNLEtBQU0sSUFBSVosV0FBV00sRUFBbUJPLFNBQVNDLG9CQUcxRnhCLEdBQUEsRUFBZWtCLEtBQUtnQixVQUFVRCxNQW5DaENFLE1BcUNTLFNBQUFDLEdBRU5wQyxHQUFBLEVBREksU0FBVW9DLEVBQ0dBLEVBQUlDLEtBQU8sS0FBT0QsRUFBSUUsUUFFdEJGLEVBQUlHLGNBbER6QixDQWlFbUJyQyxFQUFTLFNBQUNzQyxFQUFRUCxHQUM5Qk8sRUFDSmxELEVBQUFLLFFBQUU4QyxLQUFLLENBQ05DLElBQUtDLEdBQUdGLEtBQUtHLFNBQVNGLElBQ3RCRyxPQUFRLE9BQ1JDLEtBQU0sQ0FDTDdDLE9BQVFBLEVBQ1JDLFFBQVMrQixFQUNUOUIsU0FBVUEsR0FFWHFDLFFBQVN4QyxJQUdWQSxFQUFVLENBQUV3QyxTQUFBLEVBQWVGLFFBQVFMLE9Bd0NyQ2MsTUFsQ2EsU0FBRWhELEVBQU1DLEdBRWlCRCxFQUE5QkUsT0FGMkIsSUFFbkJDLEVBQXNCSCxFQUF0QkcsUUFBc0JILEVBQWJJLFNBaEsxQixTQUErQjZDLEVBQVloRCxHQUUxQyxJQUFNaUQsRUFBb0JELEVBQVd2QyxVQUMvQnlDLEVBQUs1QyxPQUFPQyxPQUFRLEdBQUl5QyxHQUU5QkUsRUFBR3pDLFVBQVksSUFBSUMsV0FBWXNDLEVBQVd2QyxXQUMxQ3lDLEVBQUdDLGlCQUFtQkQsRUFBR0MsaUJBQWlCQyxJQUFLLFNBQUFDLEdBQzlDLElBQUlDLEVBQU1oRCxPQUFPQyxPQUFRLEdBQUk4QyxHQUU3QixPQURBQyxFQUFJMUMsR0FBSyxJQUFJRixXQUFXMkMsRUFBRXpDLElBQ25CMEMsSUFJUnpELFVBQVVnQixZQUFZMEMsSUFBSyxDQUFFbEQsVUFBVzZDLElBQ3RDbkMsS0FBTSxTQUFBeUMsR0FFTixJQUFJQyxFQUFNLEdBQ1QsSUFBSS9DLFdBQVc4QyxFQUFXeEIsT0FBUUgsUUFBUSxTQUFTQyxHQUFJMkIsRUFBSTFCLEtBQUtELEtBQ2pFLElBQUliLEVBQUtDLEtBQUtDLE1BQU1DLE9BQU9DLGFBQWFDLE1BQU0sS0FDakMsSUFBSVosV0FBVzhDLEVBQVdqQyxTQUFTQyxrQkFDNUNrQyxFQUFNLEdBQ1QsSUFBSWhELFdBQVc4QyxFQUFXakMsU0FBU0MsZ0JBQWlCSyxRQUFRLFNBQVNDLEdBQUk0QixFQUFJM0IsS0FBS0QsS0FDbkYsSUFBSTZCLEVBQUssR0FDUixJQUFJakQsV0FBVzhDLEVBQVdqQyxTQUFTcUMsbUJBQW9CL0IsUUFBUSxTQUFTQyxHQUFJNkIsRUFBRzVCLEtBQUtELEtBQ3JGLElBQUkrQixFQUFNLEdBQ1QsSUFBSW5ELFdBQVc4QyxFQUFXakMsU0FBU3VDLFdBQVlqQyxRQUFRLFNBQVNDLEdBQUkrQixFQUFJOUIsS0FBS0QsS0FDOUUsSUFBSUcsRUFBTyxDQUNWUCxLQUFNOEIsRUFBVzlCLEtBQ2pCdUIsa0JBQW1CQSxFQUNuQmpCLE1BQU95QixFQUNQbEMsU0FBVSxDQUNUcUMsa0JBQW1CRCxFQUNuQkksV0FBWTlDLEVBQ1orQyxvQkFBcUJOLEVBQ3JCSSxVQUFXRCxJQUdiN0QsR0FBQSxFQUFnQmtCLEtBQUtnQixVQUFXRCxNQXhCbENFLE1BMEJTLFNBQUFDLEdBQ1A2QixRQUFRQyxJQUFJOUIsR0F3QlhwQyxHQUFBLEVBREksU0FBVW9DLEVBQ0dBLEVBQUlDLEtBQU8sS0FBT0QsRUFBSUUsUUFFdEJGLEVBQUlHLGNBbEV6QixDQWtLdUJyQyxFQUFTLFNBQUVzQyxFQUFTUCxHQUV4Q2pDLEVBREl3QyxFQUNNLENBQUVBLFNBQUEsRUFBYzJCLE9BQVFsQyxHQUV4QixDQUFFTyxTQUFBLEVBQWVGLFFBQVNMLE9BMkJ0Q21DLFlBckJtQixTQUFFckUsRUFBTUMsR0FBYyxJQUVqQ0MsRUFBOEJGLEVBQTlCRSxPQUFRQyxFQUFzQkgsRUFBdEJHLFFBQVNDLEVBQWFKLEVBQWJJLFNBRXpCYixFQUFBSyxRQUFFOEMsS0FBSyxDQUNOQyxJQUFLQyxHQUFHRixLQUFLRyxTQUFTRixJQUN0QkcsT0FBUSxPQUNSQyxLQUFNLENBQ0w3QyxPQUFRQSxFQUNSQyxRQUFTQSxFQUNUQyxTQUFVQSxHQUVYcUMsUUFBUXhDLEtBVVRKLG9CQUFBQSw4SUMxTUQsSUFBQVAsRUFBQUMsR0FBQUQsRUFBQSxvQkFBQUUsT0FBQUEsT0FBQUMsWUFBQSxJQUFBQyxFQUFBQSxFQUFBRCxPQUFBLE9BQUFILEVBQUFLLFdBQUFMLEVBQUEsQ0FBQU0sUUFBQU4sR0FLTWdGLEVBQVUsU0FBRUMsRUFBV3ZFLEdBQVUsSUFFOUJFLEVBQThCRixFQUE5QkUsT0FBUUMsRUFBc0JILEVBQXRCRyxRQUFTQyxFQUFhSixFQUFiSSxTQUluQm9FLEVBQWMsV0FBb0IsSUFBbEJDLEVBQWtCQyxVQUFBQyxPQUFBLFFBQUEsSUFBQUQsVUFBQSxJQUFBQSxVQUFBLEdBQ25DRSxHQUFBLEVBQVdyRixFQUFBSyxTQUFFMkUsR0FBV00sUUFBQSxFQUM1QnRGLEVBQUFLLFNBQUUyRSxHQUFXTSxLQUFLRCxJQUFBLEVBQ2xCckYsRUFBQUssU0FBRTJFLEdBQVdPLEtBQU0sbUJBQUEsSUFBbUIsRUFDdEN2RixFQUFBSyxTQUFFbUYsVUFBVUMsSUFBSyxZQUFBLEVBQ2pCekYsRUFBQUssU0FBRTJFLEdBQVdTLElBQUssUUFDYlAsR0FBUVEsSUFBY0wsSUFBQSxFQUMxQnJGLEVBQUFLLFNBQUUyRSxHQUFXVyxTQUFTLFNBQUEsRUFFdEI3RixFQUFBZ0YsYUFDQyxDQUNDbkUsT0FBQUEsRUFDQUMsUUFBUyxDQUFFZ0YsTUFBT2hGLEVBQVNpRixNQUFPUixHQUNsQ3hFLFNBQUFBLEdBRUQsU0FBQW9CLElBQUEsRUFDQ2pDLEVBQUFLLFNBQUUyRSxHQUFXYyxZQUFZLFdBR2RaLElBQUEsRUFDYmxGLEVBQUFLLFNBQUUyRSxHQUFXTSxLQUFLSSxJQUlkQSxHQUFBLEVBQVkxRixFQUFBSyxTQUFFMkUsR0FBV00sUUFBQSxFQUUvQnRGLEVBQUFLLFNBQUUyRSxHQUFXTyxLQUFNLG1CQUFBLElBQW1CLEVBRXRDdkYsRUFBQUssU0FBRW1GLFVBQVVPLEdBQUksVUFBVyxTQUFBQyxHQUNULEtBQVpBLEVBQUVDLE9BQ05oQixHQUFBLEdBQ0FlLEVBQUVFLGtCQUNxQixLQUFaRixFQUFFQyxPQUNiaEIsR0FBQSxNQUFhLEVBS2ZqRixFQUFBSyxTQUFFMkUsR0FDQWUsR0FBSSxPQUFRLFNBQUFDLEdBQUMsT0FBSWYsR0FBQSxLQUNqQmMsR0FBSSxRQUFTLFNBQUFDLEdBQ1ZBLEVBQUVFLGlCQUNGLElBQUlaLEdBQVFVLEVBQUVHLGVBQWlCSCxHQUFHSSxjQUFjQyxRQUFRLGNBQ3hEYixTQUFTYyxZQUFZLGNBQUEsRUFBcUJoQixNQUFBLEVBRy9DdEYsRUFBQUssU0FBRTJFLEdBQVd1QixRQUViZixTQUFTYyxZQUFhLGFBQUEsRUFBb0IsUUFBQSxFQUkzQ3RHLEVBQUFLLFNBQUVtRixVQUFVTyxHQUFJLFFBQVMseUJBQTBCLFNBQUFDLEdBRWxEQSxFQUFFRSxrQkFBQSxFQUVGbEcsRUFBQUssU0FBRTJGLEVBQUVRLFFBQVFDLEtBQUssbUJBQW1CQyxTQUNwQyxJQUFJQyxHQUFBLEVBQU8zRyxFQUFBSyxTQUFFMkYsRUFBRVEsUUFBUWIsU0FBUyxRQUUxQmxGLEVBQU9tQixLQUFLQyxPQUFBLEVBQU83QixFQUFBSyxTQUFFMkYsRUFBRVEsUUFBUUksS0FBSyx5QkFBQSxFQUUxQzlHLEVBQUFVLFVBQVVDLEVBQU0sU0FBQXdCLEdBRWYsR0FEQTBFLEVBQUtiLFlBQVksUUFDWjdELEVBQVNpQixRQUFVLENBQ3ZCLElBQ0kyRCxHQUFBLEVBRFc3RyxFQUFBSyxTQUFFNEIsRUFBUzZFLE1BQU1DLFNBQVMsa0JBQ2hCQyxLQUFLLG1CQUU5QmpDLEVBQ0M4QixFQUFVNUMsSUFBSSxHQUNkckMsS0FBS0MsTUFBT2dGLEVBQVVELEtBQUssc0JBQUEsRUFHNUI1RyxFQUFBSyxTQUFBLDRDQUFBNEcsT0FBOENoRixFQUFTZSxRQUF2RCxZQUF5RWtFLFlBQVksOEJBTW5GcEgsRUFBQVEscUJBQUEsRUFDSk4sRUFBQUssU0FBRW1GLFVBQVVPLEdBQUcsUUFBUSxtQkFBb0IsU0FBQUMsR0FDMUNBLEVBQUVFLGlCQUNGLElBQU1TLEdBQUEsRUFBTzNHLEVBQUFLLFNBQUUyRixFQUFFUSxRQUFRVyxRQUFRLG9CQUMzQjFHLEVBQU9tQixLQUFLQyxNQUFPOEUsRUFBS0MsS0FBSyxnQkFDN0JRLEdBQUEsRUFBU3BILEVBQUFLLFNBQUUyRixFQUFFUSxRQUFRVyxRQUFRLGlCQUMzQnhHLEVBQThCRixFQUE5QkUsT0FBaUJFLEdBQWFKLEVBQXRCRyxRQUFzQkgsRUFBYkksVUFJSixzQkFBaEJKLEVBQUtFLFFBQ1RxRixFQUFFRSxpQkFDRmtCLEVBQU9KLEtBQUssV0FBV04sU0FDdkJDLEVBQUtoQixTQUFTLFNBQUEsRUFDZDdGLEVBQUEyRCxPQUFPaEQsRUFBTSxTQUFBb0UsR0FHWixJQUFPQSxFQUFPM0IsUUFHYixPQUZBa0UsRUFBT0MsT0FBUCxvREFBQUosT0FBa0VwQyxFQUFPN0IsUUFBekUsZ0JBQ0EyRCxFQUFLYixZQUFZLFNBQUEsRUFHbEJoRyxFQUFBZ0YsYUFBYSxDQUFFbkUsT0FBQUEsRUFBUUMsUUFBU2lFLEVBQU9BLE9BQVFoRSxTQUFBQSxHQUFZLFNBQUFvQixHQUNyREEsRUFBU2lCLFFBQ2J5RCxFQUFLSyxLQUFLLGlCQUFpQkosS0FBSyxjQUFjLFdBRTlDRCxFQUFLSyxLQUFLLGlCQUFpQkosS0FBSyxjQUFjLFFBQzlDUSxFQUFPQyxPQUFQLGtEQUFBSixPQUFnRWhGLEVBQVNlLFFBQXpFLFlBRUQyRCxFQUFLYixZQUFZLGFBR1Esd0JBQWhCckYsRUFBS0UsU0FDaEJ5RyxFQUFPekIsU0FBUyxRQUNoQkssRUFBRUUsa0JBQUEsRUFDRnBHLEVBQUFnRixhQUFhckUsRUFBTSxTQUFVd0IsR0FFdkJBLEVBQVNpQixTQUVia0UsRUFBT1YsWUFHYSxzQkFBaEJqRyxFQUFLRSxRQUNOLFVBQUEsRUFBV1gsRUFBQUssU0FBRTJGLEVBQUVzQixlQUFlL0IsS0FBTSxxQkFDeENTLEVBQUVFLGlCQUNGbkIsRUFBU2lCLEVBQUVzQixjQUFlN0csUUFBQSxFQUs3QlQsRUFBQUssU0FBRSx5QkFBeUJ5RixZQUFZLFdBQUEsRUFDdkM5RixFQUFBSyxTQUFFLHVCQUF1QnNGLFNBQVMsNEhGNUluQyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xuIiwiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuXG5cblxuXG4vKipcbiAqXHRTdG9sZW4gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZGF2aWRlYXJsL3dlYmF1dGhuXG4gKi9cbmZ1bmN0aW9uIHdlYmF1dGhuQXV0aGVudGljYXRlKCBwdWJLZXlBdXRoLCBjYWxsYmFjayApIHtcblxuXHRjb25zdCBvcmlnaW5hbENoYWxsZW5nZSA9IHB1YktleUF1dGguY2hhbGxlbmdlO1xuXHRjb25zdCBwayA9IE9iamVjdC5hc3NpZ24oIHt9LCBwdWJLZXlBdXRoIClcblxuXHRway5jaGFsbGVuZ2UgPSBuZXcgVWludDhBcnJheSggcHViS2V5QXV0aC5jaGFsbGVuZ2UgKVxuXHRway5hbGxvd0NyZWRlbnRpYWxzID0gcGsuYWxsb3dDcmVkZW50aWFscy5tYXAoIGsgPT4ge1xuXHRcdGxldCByZXQgPSBPYmplY3QuYXNzaWduKCB7fSwgayApXG5cdFx0cmV0LmlkID0gbmV3IFVpbnQ4QXJyYXkoay5pZCk7XG5cdFx0cmV0dXJuIHJldFxuXHR9IClcblxuXHQvKiBhc2sgdGhlIGJyb3dzZXIgdG8gcHJvbXB0IHRoZSB1c2VyICovXG5cdG5hdmlnYXRvci5jcmVkZW50aWFscy5nZXQoIHsgcHVibGljS2V5OiBwayB9IClcblx0XHQudGhlbiggYUFzc2VydGlvbiA9PiB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyhcIkNyZWRlbnRpYWxzLkdldCByZXNwb25zZTogXCIsIGFBc3NlcnRpb24pO1xuXHRcdFx0dmFyIGlkYSA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmF3SWQpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpeyBpZGEucHVzaCh2KTsgfSk7XG5cdFx0XHR2YXIgY2QgPSBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2UuY2xpZW50RGF0YUpTT04pKSk7XG5cdFx0XHR2YXIgY2RhID0gW107XG5cdFx0XHQobmV3IFVpbnQ4QXJyYXkoYUFzc2VydGlvbi5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpLmZvckVhY2goZnVuY3Rpb24odil7IGNkYS5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBhZCA9IFtdO1xuXHRcdFx0KG5ldyBVaW50OEFycmF5KGFBc3NlcnRpb24ucmVzcG9uc2UuYXV0aGVudGljYXRvckRhdGEpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpeyBhZC5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBzaWcgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhQXNzZXJ0aW9uLnJlc3BvbnNlLnNpZ25hdHVyZSkpLmZvckVhY2goZnVuY3Rpb24odil7IHNpZy5wdXNoKHYpOyB9KTtcblx0XHRcdHZhciBpbmZvID0ge1xuXHRcdFx0XHR0eXBlOiBhQXNzZXJ0aW9uLnR5cGUsXG5cdFx0XHRcdG9yaWdpbmFsQ2hhbGxlbmdlOiBvcmlnaW5hbENoYWxsZW5nZSxcblx0XHRcdFx0cmF3SWQ6IGlkYSxcblx0XHRcdFx0cmVzcG9uc2U6IHtcblx0XHRcdFx0XHRhdXRoZW50aWNhdG9yRGF0YTogYWQsXG5cdFx0XHRcdFx0Y2xpZW50RGF0YTogY2QsXG5cdFx0XHRcdFx0Y2xpZW50RGF0YUpTT05hcnJheTogY2RhLFxuXHRcdFx0XHRcdHNpZ25hdHVyZTogc2lnXG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHRjYWxsYmFjayggdHJ1ZSwgSlNPTi5zdHJpbmdpZnkoIGluZm8gKSApO1xuXHRcdH0pXG5cdFx0LmNhdGNoKCBlcnIgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coZXJyKVxuXHRcdFx0Lypcblx0XHRcdEZGIG1hYzpcblx0XHRcdEludmFsaWRTdGF0ZUVycm9yOiBrZXkgbm90IGZvdW5kXG5cdFx0XHRBYm9ydEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6ID9cblx0XHRcdFx0VGhlIHJlcXVlc3QgaXMgbm90IGFsbG93ZWQgYnkgdGhlIHVzZXIgYWdlbnQgb3IgdGhlIHBsYXRmb3JtIGluIHRoZSBjdXJyZW50IGNvbnRleHQsIHBvc3NpYmx5IGJlY2F1c2UgdGhlIHVzZXIgZGVuaWVkIHBlcm1pc3Npb24uXG5cblx0XHRcdENocm9tZSBtYWM6XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblxuXHRcdFx0U2FmYXJpIG1hYzpcblx0XHRcdE5vdEFsbG93ZWRFcnJvcjogdXNlciBhYm9ydGVkIG9yIGRlbmllZFxuXG5cdFx0XHRFZGdlIHdpbjEwOlxuXHRcdFx0VW5rbm93bkVycm9yOiB3cm9uZyBrZXkuLi4/XG5cdFx0XHROb3RBbGxvd2VkRXJyb3I6IHVzZXIgYWJvcnRlZCBvciBkZW5pZWRcblxuXHRcdFx0RkYgd2luOlxuXHRcdFx0Tm90QWxsb3dlZEVycm9yOiB1c2VyIGFib3J0ZWQgb3IgZGVuaWVkXG5cdFx0XHRcdERPTUV4Y2VwdGlvbjogXCJUaGUgcmVxdWVzdCBpcyBub3QgYWxsb3dlZCBieSB0aGUgdXNlciBhZ2VudCBvciB0aGUgcGxhdGZvcm0gaW4gdGhlIGN1cnJlbnQgY29udGV4dCwgcG9zc2libHkgYmVjYXVzZSB0aGUgdXNlciBkZW5pZWQgcGVybWlzc2lvbi5cIlxuXG5cdFx0XHQqL1xuXHRcdFx0aWYgKCBcIm5hbWVcIiBpbiBlcnIgKSB7XG5cdFx0XHRcdGNhbGxiYWNrKCBmYWxzZSwgZXJyLm5hbWUgKyAnOiAnICsgZXJyLm1lc3NhZ2UgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNhbGxiYWNrKCBmYWxzZSwgZXJyLnRvU3RyaW5nKCkgKTtcblx0XHRcdH1cblx0XHR9KTtcbn1cblxuLyoqXG4gKlx0U3RvbGVuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2RhdmlkZWFybC93ZWJhdXRoblxuICovXG5mdW5jdGlvbiB3ZWJhdXRoblJlZ2lzdGVyKCBrZXksIGNhbGxiYWNrICl7XG5cblx0bGV0IHB1YmxpY0tleSA9IE9iamVjdC5hc3NpZ24oIHt9LCBrZXkucHVibGljS2V5ICk7XG5cblx0cHVibGljS2V5LmF0dGVzdGF0aW9uID0gdW5kZWZpbmVkO1xuXHRwdWJsaWNLZXkuY2hhbGxlbmdlID0gbmV3IFVpbnQ4QXJyYXkoIHB1YmxpY0tleS5jaGFsbGVuZ2UgKTsgLy8gY29udmVydCB0eXBlIGZvciB1c2UgYnkga2V5XG5cdHB1YmxpY0tleS51c2VyLmlkID0gbmV3IFVpbnQ4QXJyYXkoIHB1YmxpY0tleS51c2VyLmlkICk7XG5cblx0Ly8gY29uc29sZS5sb2coa2V5KTtcblx0bmF2aWdhdG9yLmNyZWRlbnRpYWxzLmNyZWF0ZSggeyBwdWJsaWNLZXkgfSApXG5cdFx0LnRoZW4oZnVuY3Rpb24gKGFOZXdDcmVkZW50aWFsSW5mbykge1xuXHRcdFx0Ly8gY29uc29sZS5sb2coXCJDcmVkZW50aWFscy5DcmVhdGUgcmVzcG9uc2U6IFwiLCBhTmV3Q3JlZGVudGlhbEluZm8pO1xuXHRcdFx0dmFyIGNkID0gSlNPTi5wYXJzZShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KGFOZXdDcmVkZW50aWFsSW5mby5yZXNwb25zZS5jbGllbnREYXRhSlNPTikpKTtcblx0XHRcdGlmICgga2V5LmI2NGNoYWxsZW5nZSAhPT0gY2QuY2hhbGxlbmdlICkge1xuXHRcdFx0XHRjYWxsYmFjayhmYWxzZSwgJ2tleSByZXR1cm5lZCBzb21ldGhpbmcgdW5leHBlY3RlZCAoMSknKTtcblx0XHRcdH1cblx0XHRcdC8vIGlmICgnaHR0cHM6Ly8nK2tleS5wdWJsaWNLZXkucnAubmFtZSAhPSBjZC5vcmlnaW4pIHtcblx0XHRcdC8vIFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgyKScpO1xuXHRcdFx0Ly8gfVxuXHRcdFx0aWYgKCEgKCd0eXBlJyBpbiBjZCkpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICgzKScpO1xuXHRcdFx0fVxuXHRcdFx0aWYgKGNkLnR5cGUgIT0gJ3dlYmF1dGhuLmNyZWF0ZScpIHtcblx0XHRcdFx0cmV0dXJuIGNhbGxiYWNrKGZhbHNlLCAna2V5IHJldHVybmVkIHNvbWV0aGluZyB1bmV4cGVjdGVkICg0KScpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgYW8gPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmVzcG9uc2UuYXR0ZXN0YXRpb25PYmplY3QpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpe1xuXHRcdFx0XHRhby5wdXNoKHYpO1xuXHRcdFx0fSk7XG5cdFx0XHR2YXIgcmF3SWQgPSBbXTtcblx0XHRcdChuZXcgVWludDhBcnJheShhTmV3Q3JlZGVudGlhbEluZm8ucmF3SWQpKS5mb3JFYWNoKGZ1bmN0aW9uKHYpe1xuXHRcdFx0XHRyYXdJZC5wdXNoKHYpO1xuXHRcdFx0fSk7XG5cdFx0XHR2YXIgaW5mbyA9IHtcblx0XHRcdFx0cmF3SWQ6IHJhd0lkLFxuXHRcdFx0XHRpZDogYU5ld0NyZWRlbnRpYWxJbmZvLmlkLFxuXHRcdFx0XHR0eXBlOiBhTmV3Q3JlZGVudGlhbEluZm8udHlwZSxcblx0XHRcdFx0cmVzcG9uc2U6IHtcblx0XHRcdFx0XHRhdHRlc3RhdGlvbk9iamVjdDogYW8sXG5cdFx0XHRcdFx0Y2xpZW50RGF0YUpTT046XG5cdFx0XHRcdFx0ICBKU09OLnBhcnNlKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoYU5ld0NyZWRlbnRpYWxJbmZvLnJlc3BvbnNlLmNsaWVudERhdGFKU09OKSkpXG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHRjYWxsYmFjayh0cnVlLCBKU09OLnN0cmluZ2lmeShpbmZvKSk7XG5cdFx0fSlcblx0XHQuY2F0Y2goIGVyciA9PiB7XG5cdFx0XHRpZiAoIFwibmFtZVwiIGluIGVyciApIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIubmFtZSArICc6ICcgKyBlcnIubWVzc2FnZSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2FsbGJhY2soIGZhbHNlLCBlcnIudG9TdHJpbmcoKSApO1xuXHRcdFx0fVxuXHRcdH0pO1xufVxuXG4vKipcbiAqXHRAcGFyYW0gQXJyYXlCdWZmZXIgYXJyYXlCdWZcbiAqXHRAcmV0dXJuIEFycmF5XG4gKi9cbmNvbnN0IGJ1ZmZlcjJBcnJheSA9IGFycmF5QnVmID0+IFsgLi4uIChuZXcgVWludDhBcnJheSggYXJyYXlCdWYgKSkgXTtcblxuY29uc3QgcmVnaXN0ZXIgPSAoIG9wdHMsIGNhbGxiYWNrICkgPT4ge1xuXG5cdGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkLCBfd3Bub25jZSB9ID0gb3B0cztcblxuXHR3ZWJhdXRoblJlZ2lzdGVyKCBwYXlsb2FkLCAoc3VjY2VzcyxpbmZvKSA9PiB7XG5cdFx0aWYgKCBzdWNjZXNzICkge1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOiB3cC5hamF4LnNldHRpbmdzLnVybCxcblx0XHRcdFx0bWV0aG9kOiAncG9zdCcsXG5cdFx0XHRcdGRhdGE6IHtcblx0XHRcdFx0XHRhY3Rpb246IGFjdGlvbixcblx0XHRcdFx0XHRwYXlsb2FkOiBpbmZvLFxuXHRcdFx0XHRcdF93cG5vbmNlOiBfd3Bub25jZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRzdWNjZXNzOiBjYWxsYmFja1xuXHRcdFx0fSlcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2FsbGJhY2soIHsgc3VjY2VzczpmYWxzZSwgbWVzc2FnZTppbmZvIH0gKVxuXHRcdH1cblx0fSlcbn1cblxuXG5jb25zdCBsb2dpbiA9ICggb3B0cywgY2FsbGJhY2sgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzO1xuXG5cdHdlYmF1dGhuQXV0aGVudGljYXRlKCBwYXlsb2FkLCAoIHN1Y2Nlc3MsIGluZm8gKSA9PiB7XG5cdFx0aWYgKCBzdWNjZXNzICkge1xuXHRcdFx0Y2FsbGJhY2soIHsgc3VjY2Vzczp0cnVlLCByZXN1bHQ6IGluZm8gfSApXG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbGxiYWNrKCB7IHN1Y2Nlc3M6ZmFsc2UsIG1lc3NhZ2U6IGluZm8gfSApXG5cdFx0fVxuXG5cdH0pXG59XG5cbmNvbnN0IHNlbmRSZXF1ZXN0ID0gKCBvcHRzLCBjYWxsYmFjayApID0+IHtcblxuXHRjb25zdCB7IGFjdGlvbiwgcGF5bG9hZCwgX3dwbm9uY2UgfSA9IG9wdHM7XG5cblx0JC5hamF4KHtcblx0XHR1cmw6IHdwLmFqYXguc2V0dGluZ3MudXJsLFxuXHRcdG1ldGhvZDogJ3Bvc3QnLFxuXHRcdGRhdGE6IHtcblx0XHRcdGFjdGlvbjogYWN0aW9uLFxuXHRcdFx0cGF5bG9hZDogcGF5bG9hZCxcblx0XHRcdF93cG5vbmNlOiBfd3Bub25jZVxuXHRcdH0sXG5cdFx0c3VjY2VzczpjYWxsYmFja1xuXHR9KVxufVxuXG5jb25zdCBpc1dlYmF1dGhuU3VwcG9ydGVkID0gJ2NyZWRlbnRpYWxzJyBpbiBuYXZpZ2F0b3JcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdHJlZ2lzdGVyLFxuXHRsb2dpbixcblx0c2VuZFJlcXVlc3QsXG5cdGlzV2ViYXV0aG5TdXBwb3J0ZWRcbn1cbiIsImltcG9ydCAkIGZyb20gJ2pxdWVyeSdcbmltcG9ydCB7IHJlZ2lzdGVyLCBsb2dpbiwgc2VuZFJlcXVlc3QsIGlzV2ViYXV0aG5TdXBwb3J0ZWQgfSBmcm9tICdkYXZpZGVhcmwtd2ViYXV0aG4nXG5cblxuXG5jb25zdCBlZGl0S2V5ID0gKCBlZGl0TGFiZWwsIG9wdHMgKSA9PiB7XG5cblx0Y29uc3QgeyBhY3Rpb24sIHBheWxvYWQsIF93cG5vbmNlIH0gPSBvcHRzXG5cblxuXHQvLyBjb25zb2xlLmxvZygkZWRpdExhYmVsLnByb3AoICdjb250ZW50ZWRpdGFibGUnICkpO1xuXHRjb25zdCBzdG9wRWRpdGluZyA9ICggc2F2ZSA9IGZhbHNlICkgPT4ge1xuXHRcdGxldCBuZXdMYWJlbCA9ICQoZWRpdExhYmVsKS50ZXh0KClcblx0XHQkKGVkaXRMYWJlbCkudGV4dChuZXdMYWJlbClcblx0XHQkKGVkaXRMYWJlbCkucHJvcCggJ2NvbnRlbnRlZGl0YWJsZScsIGZhbHNlICk7XG5cdFx0JChkb2N1bWVudCkub2ZmKCAna2V5ZG93bicgKVxuXHRcdCQoZWRpdExhYmVsKS5vZmYoICdibHVyJyApXG5cdFx0aWYgKCBzYXZlICYmIHByZXZMYWJlbCAhPT0gbmV3TGFiZWwgKSB7XG5cdFx0XHQkKGVkaXRMYWJlbCkuYWRkQ2xhc3MoJ2J1c3knKVxuXG5cdFx0XHRzZW5kUmVxdWVzdChcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGFjdGlvbixcblx0XHRcdFx0XHRwYXlsb2FkOiB7IG1kNWlkOiBwYXlsb2FkLCBsYWJlbDogbmV3TGFiZWwgfSxcblx0XHRcdFx0XHRfd3Bub25jZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRyZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0JChlZGl0TGFiZWwpLnJlbW92ZUNsYXNzKCdidXN5Jylcblx0XHRcdFx0fVxuXHRcdFx0KTtcblx0XHR9IGVsc2UgaWYgKCAhIHNhdmUgKSB7XG5cdFx0XHQkKGVkaXRMYWJlbCkudGV4dChwcmV2TGFiZWwpXG5cdFx0fVxuXHR9XG5cblx0Y29uc3QgcHJldkxhYmVsID0gJChlZGl0TGFiZWwpLnRleHQoKVxuXG5cdCQoZWRpdExhYmVsKS5wcm9wKCAnY29udGVudGVkaXRhYmxlJywgdHJ1ZSApO1xuXG5cdCQoZG9jdW1lbnQpLm9uKCAna2V5ZG93bicsIGUgPT4ge1xuXHRcdGlmICggZS53aGljaCA9PT0gMTMgKSB7XG5cdFx0XHRzdG9wRWRpdGluZyggdHJ1ZSApXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHR9IGVsc2UgaWYgKCBlLndoaWNoID09PSAyNyApIHtcblx0XHRcdHN0b3BFZGl0aW5nKCB0cnVlIClcblx0XHR9XG5cdH0gKVxuXG5cdC8vIGZvY3VzIGFuZCBzZWxlY3Rcblx0JChlZGl0TGFiZWwpXG5cdFx0Lm9uKCAnYmx1cicsIGUgPT4gc3RvcEVkaXRpbmcoIHRydWUgKSApXG5cdFx0Lm9uKCAncGFzdGUnLCBlID0+IHtcblx0XHQgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdCAgICBsZXQgdGV4dCA9IChlLm9yaWdpbmFsRXZlbnQgfHwgZSkuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XG5cdFx0ICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiaW5zZXJ0SFRNTFwiLCBmYWxzZSwgdGV4dCk7XG5cdFx0fSApXG5cblx0JChlZGl0TGFiZWwpLmZvY3VzKClcblxuXHRkb2N1bWVudC5leGVjQ29tbWFuZCggJ3NlbGVjdEFsbCcsIGZhbHNlLCBudWxsICk7XG5cbn1cblxuJChkb2N1bWVudCkub24oICdjbGljaycsICcjd2ViYXV0aG4tcmVnaXN0ZXIta2V5JywgZSA9PiB7XG5cblx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdCQoZS50YXJnZXQpLm5leHQoJy53ZWJhdXRobi1lcnJvcicpLnJlbW92ZSgpXG5cdGxldCAkYnRuID0gJChlLnRhcmdldCkuYWRkQ2xhc3MoJ2J1c3knKVxuXG5cdGNvbnN0IG9wdHMgPSBKU09OLnBhcnNlKCAkKGUudGFyZ2V0KS5hdHRyKCdkYXRhLWNyZWF0ZS1vcHRpb25zJykgKTtcblxuXHRyZWdpc3Rlciggb3B0cywgcmVzcG9uc2UgPT4ge1xuXHRcdCRidG4ucmVtb3ZlQ2xhc3MoJ2J1c3knKVxuXHRcdGlmICggcmVzcG9uc2Uuc3VjY2VzcyApIHtcblx0XHRcdGxldCAka2V5SXRlbSA9ICQocmVzcG9uc2UuaHRtbCkuYXBwZW5kVG8oJyN3ZWJhdXRobi1rZXlzJylcblx0XHRcdGxldCAka2V5TGFiZWwgPSAka2V5SXRlbS5maW5kKCcud2ViYXV0aG4tbGFiZWwnKVxuXG5cdFx0XHRlZGl0S2V5KFxuXHRcdFx0XHQka2V5TGFiZWwuZ2V0KDApLFxuXHRcdFx0XHRKU09OLnBhcnNlKCAka2V5TGFiZWwuYXR0cignZGF0YS1hY3Rpb24nKSApXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkKGA8c3BhbiBjbGFzcz1cIndlYmF1dGhuLWVycm9yIGRlc2NyaXB0aW9uXCI+JHtyZXNwb25zZS5tZXNzYWdlfTwvc3Bhbj5gKS5pbnNlcnRBZnRlcignI3dlYmF1dGhuLXJlZ2lzdGVyLWtleScpXG5cdFx0fVxuXHR9KTtcblxufSk7XG5cbmlmICggaXNXZWJhdXRoblN1cHBvcnRlZCApIHtcblx0JChkb2N1bWVudCkub24oJ2NsaWNrJywnLndlYmF1dGhuLWFjdGlvbicsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRjb25zdCAkYnRuID0gJChlLnRhcmdldCkuY2xvc2VzdCgnLndlYmF1dGhuLWFjdGlvbicpO1xuXHRcdGNvbnN0IG9wdHMgPSBKU09OLnBhcnNlKCAkYnRuLmF0dHIoJ2RhdGEtYWN0aW9uJykgKTtcblx0XHRjb25zdCAka2V5RWwgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCcud2ViYXV0aG4ta2V5Jylcblx0XHRjb25zdCB7IGFjdGlvbiwgcGF5bG9hZCwgX3dwbm9uY2UgfSA9IG9wdHNcblxuXG5cblx0XHRpZiAoIG9wdHMuYWN0aW9uID09PSAnd2ViYXV0aG4tdGVzdC1rZXknICkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0JGtleUVsLmZpbmQoJy5ub3RpY2UnKS5yZW1vdmUoKTtcblx0XHRcdCRidG4uYWRkQ2xhc3MoJ2J1c3knKTtcblx0XHRcdGxvZ2luKCBvcHRzLCByZXN1bHQgPT4ge1xuXHRcdFx0XHQvLyBzZW5kIHRoYXQgY3JhcCB0byBzZXJ2ZXJcblxuXHRcdFx0XHRpZiAoICEgcmVzdWx0LnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdFx0JGtleUVsLmFwcGVuZChgPGRpdiBjbGFzcz1cIm5vdGljZSBub3RpY2UtaW5saW5lIG5vdGljZS13YXJuaW5nXCI+JHtyZXN1bHQubWVzc2FnZX08L2Rpdj5gKVxuXHRcdFx0XHRcdCRidG4ucmVtb3ZlQ2xhc3MoJ2J1c3knKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0c2VuZFJlcXVlc3QoIHsgYWN0aW9uLCBwYXlsb2FkOiByZXN1bHQucmVzdWx0LCBfd3Bub25jZSB9LCByZXNwb25zZSA9PiB7XG5cdFx0XHRcdFx0aWYgKCByZXNwb25zZS5zdWNjZXNzICkge1xuXHRcdFx0XHRcdFx0JGJ0bi5maW5kKCdbZGF0YS10ZXN0ZWRdJykuYXR0cignZGF0YS10ZXN0ZWQnLCd0ZXN0ZWQnKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHQkYnRuLmZpbmQoJ1tkYXRhLXRlc3RlZF0nKS5hdHRyKCdkYXRhLXRlc3RlZCcsJ2ZhaWwnKVxuXHRcdFx0XHRcdFx0JGtleUVsLmFwcGVuZChgPGRpdiBjbGFzcz1cIm5vdGljZSBub3RpY2UtaW5saW5lIG5vdGljZS1lcnJvclwiPiR7cmVzcG9uc2UubWVzc2FnZX08L2Rpdj5gKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQkYnRuLnJlbW92ZUNsYXNzKCdidXN5Jyk7XG5cdFx0XHRcdH0pXG5cdFx0XHR9ICk7XG5cdFx0fSBlbHNlIGlmICggb3B0cy5hY3Rpb24gPT09ICd3ZWJhdXRobi1kZWxldGUta2V5JyApIHtcblx0XHRcdCRrZXlFbC5hZGRDbGFzcygnYnVzeScpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0c2VuZFJlcXVlc3QoIG9wdHMsIGZ1bmN0aW9uKCByZXNwb25zZSApIHtcblx0XHRcdFx0Ly8gcmVtb3ZlXG5cdFx0XHRcdGlmICggcmVzcG9uc2Uuc3VjY2VzcyApIHtcblxuXHRcdFx0XHRcdCRrZXlFbC5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSApO1xuXHRcdH0gaWYgKCBvcHRzLmFjdGlvbiA9PT0gJ3dlYmF1dGhuLWVkaXQta2V5JyApIHtcblx0XHRcdGlmICggJ3RydWUnICE9PSAkKGUuY3VycmVudFRhcmdldCkucHJvcCggJ2NvbnRlbnRlZGl0YWJsZScgKSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRlZGl0S2V5KCBlLmN1cnJlbnRUYXJnZXQsIG9wdHMgKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufSBlbHNlIHtcblx0JCgnLndlYmF1dGhuLXVuc3VwcG9ydGVkJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuXHQkKCcud2ViYXV0aG4tc3VwcG9ydGVkJykuYWRkQ2xhc3MoJ2hpZGRlbicpO1xufVxuIl19